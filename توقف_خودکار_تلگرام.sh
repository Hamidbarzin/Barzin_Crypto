#!/bin/bash
#
# اسکریپت توقف سرویس خودکار تلگرام کریپتو برزین
# =================================================
#
# این اسکریپت برای توقف سرویس خودکار ارسال پیام‌های تلگرام طراحی شده است.
# هدف اصلی آن سادگی کاربری برای کاربران است و نیاز به دانش فنی را کاهش می‌دهد.
#

echo "--------------------------------------------"
echo "🛑 توقف سرویس تلگرام - کریپتو برزین"
echo "--------------------------------------------"
echo

# بررسی که آیا سرویس در حال اجراست یا خیر
if ! curl -s localhost:5000/api/telegram/status | grep -q '"running": true'; then
    echo "❌ سرویس تلگرام در حال اجرا نیست."
    echo "برای راه‌اندازی سرویس، از دستور زیر استفاده کنید:"
    echo "./اجرای_خودکار_تلگرام.sh"
    exit 1
fi

# دریافت وضعیت فعلی
echo "🔍 بررسی وضعیت فعلی سرویس..."
curl -s localhost:5000/api/telegram/status
echo 

# تلاش برای توقف سرویس
echo "🚫 در حال توقف سرویس تلگرام..."
RESULT=$(curl -s localhost:5000/api/telegram/stop)

# بررسی نتیجه
if echo "$RESULT" | grep -q '"success": true'; then
    echo "✅ سرویس تلگرام با موفقیت متوقف شد."
    echo 
    echo "🔹 برای راه‌اندازی مجدد سرویس از دستور زیر استفاده کنید:"
    echo "🔹 ./اجرای_خودکار_تلگرام.sh"
    echo 
    echo "📝 برای اطلاعات بیشتر، راهنمای_تلگرام.md را مطالعه کنید."
else
    echo "❌ خطا در توقف سرویس تلگرام."
    echo 
    echo "پاسخ سرور:"
    echo "$RESULT"
fi

echo
echo "برای مشاهده پنل کنترل تلگرام، به آدرس زیر مراجعه کنید:"
echo "http://localhost:5000/telegram_control_panel"
echo