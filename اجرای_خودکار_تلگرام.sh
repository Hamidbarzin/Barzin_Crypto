#!/bin/bash
#
# اسکریپت راه‌اندازی سرویس خودکار تلگرام کریپتو برزین
# ======================================================
#
# این اسکریپت برای راه‌اندازی سرویس خودکار ارسال پیام‌های تلگرام طراحی شده است.
# هدف اصلی آن سادگی کاربری برای کاربران است و نیاز به دانش فنی را کاهش می‌دهد.
#

echo "--------------------------------------------"
echo "🤖 راه‌اندازی سرویس تلگرام - کریپتو برزین"
echo "--------------------------------------------"
echo

# بررسی که آیا سرویس در حال اجراست یا خیر
if curl -s localhost:5000/api/telegram/status | grep -q '"running": true'; then
    echo "❌ سرویس تلگرام از قبل در حال اجراست."
    echo "برای راه‌اندازی مجدد، ابتدا باید سرویس را متوقف کنید:"
    echo "./توقف_خودکار_تلگرام.sh"
    exit 1
fi

# دریافت وضعیت فعلی
echo "🔍 بررسی وضعیت فعلی سرویس..."
curl -s localhost:5000/api/telegram/status
echo 

# تلاش برای راه‌اندازی سرویس
echo "🚀 در حال راه‌اندازی سرویس تلگرام..."
RESULT=$(curl -s localhost:5000/api/telegram/start)

# بررسی نتیجه
if echo "$RESULT" | grep -q '"success": true'; then
    echo "✅ سرویس تلگرام با موفقیت راه‌اندازی شد."
    echo 
    echo "🔹 سرویس تلگرام هر ۱۰ دقیقه یک گزارش قیمت ارسال می‌کند."
    echo "🔹 هر ۶ ساعت یک گزارش وضعیت سیستم ارسال می‌شود."
    echo 
    echo "📝 برای اطلاعات بیشتر، راهنمای_تلگرام.md را مطالعه کنید."
else
    echo "❌ خطا در راه‌اندازی سرویس تلگرام."
    echo 
    echo "پاسخ سرور:"
    echo "$RESULT"
fi

echo
echo "برای مشاهده پنل کنترل تلگرام، به آدرس زیر مراجعه کنید:"
echo "http://localhost:5000/telegram_control_panel"
echo