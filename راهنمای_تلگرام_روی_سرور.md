# ุฑุงูููุง ุงุฌุฑุง ุณุฑูุณ ุชูฺฏุฑุงู Crypto Barzin ุฑู ุณุฑูุฑ ุฎุงุฑุฌ

ุจุฑุง ุงุฌุฑุง ูพุงุฏุงุฑ ุณุฑูุณ ุชูฺฏุฑุงู Crypto Barzinุ ุจูุชุฑ ุงุณุช ุขู ุฑุง ุฑู ฺฉ ุณุฑูุฑ ุฎุงุฑุฌ ูุซู Fly.io ูุฒุจุงู ฺฉูุฏ. ุงู ุฑุงูููุง ูุฑุงุญู ุงุตู ุฑุง ุชูุถุญ ูโุฏูุฏ.

## ูพุดโูุงุฒูุง

1. ุญุณุงุจ ฺฉุงุฑุจุฑ Fly.io
2. ูุตุจ flyctl ุฑู ุณุณุชู 
3. ุฏุณุชุฑุณ ุจู ุชูฺฉู ู ฺุช ุขุฏ ุชูฺฏุฑุงู

## ูุฑุงุญู ุงุฌุฑุง

### ฑ. ุณุงุฎุช ูุงู ุงุตู ุงุฌุฑุง

ุงุจุชุฏุง ฺฉ ูุงู ุจุง ูุงู `telegram_service.py` ุงุฌุงุฏ ฺฉูุฏ:

```python
#!/usr/bin/env python3
"""
ุณุฑูุณ ุชูฺฏุฑุงู Crypto Barzin
"""

import time
import logging
import random
import os
import sys
from datetime import datetime, timedelta

# ุชูุธู ูุงฺฏุฑ
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.StreamHandler(),
        logging.FileHandler("telegram_service.log")
    ]
)
logger = logging.getLogger("telegram_service")

# ูุงุฑุฏุณุงุฒ ูุงฺููโูุง
try:
    import simple_telegram_sender as telegram
    import simple_telegram_formatter as formatter
    import chart_generator
    logger.info("ูุงฺููโูุง ุชูฺฏุฑุงู ุจุง ููููุช ุจุงุฑฺฏุฐุงุฑ ุดุฏูุฏ")
except ImportError as e:
    logger.error(f"ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฐุงุฑ ูุงฺููโูุง ุชูฺฏุฑุงู: {str(e)}")
    sys.exit(1)

def run_telegram_service():
    """
    ุงุฌุฑุง ุณุฑูุณ ุชูฺฏุฑุงู
    """
    logger.info("ุดุฑูุน ุณุฑูุณ ุชูฺฏุฑุงู Crypto Barzin")
    
    # ุงุฑุณุงู ูพุงู ุชุณุช ุงููู
    logger.info("ุงุฑุณุงู ูพุงู ุชุณุช ุงููู")
    test_result = formatter.send_test_message()
    logger.info(f"ูุชุฌู ุงุฑุณุงู ูพุงู ุชุณุช: {test_result}")
    
    # ุฒูุงูโูุง ุขุฎุฑู ุงุฑุณุงู
    last_report_time = datetime.now() - timedelta(minutes=10)  # ุจุฑุง ุงุฑุณุงู ููุฑ ฺฏุฒุงุฑุด ุงููู
    last_alive_time = datetime.now()
    report_count = 1
    
    try:
        while True:
            # ุฒูุงู ูุนู
            now = datetime.now()
            
            # ุจุฑุฑุณ ุฒูุงู ุงุฑุณุงู ฺฏุฒุงุฑุด (ูุฑ ณฐ ุฏููู ฺฉ ุจุงุฑ)
            if now - last_report_time >= timedelta(minutes=30):
                logger.info(f"ุงุฑุณุงู ฺฏุฒุงุฑุด ุดูุงุฑู {report_count}")
                
                try:
                    # ุงุฑุณุงู ฺฏุฒุงุฑุด ุจุงุฒุงุฑ
                    market_result = formatter.send_market_overview()
                    logger.info(f"ูุชุฌู ุงุฑุณุงู ฺฏุฒุงุฑุด ุจุงุฒุงุฑ: {market_result}")
                    
                    # ุงุฑุณุงู ุชุญูู ฺฉ ุงุฑุฒ ุชุตุงุฏู
                    symbols = ["BTC/USDT", "ETH/USDT", "BNB/USDT", "XRP/USDT", "SOL/USDT"]
                    symbol = random.choice(symbols)
                    analysis_result = formatter.send_coin_analysis(symbol)
                    logger.info(f"ูุชุฌู ุงุฑุณุงู ุชุญูู {symbol}: {analysis_result}")
                    
                    # ุงุฑุณุงู ุณฺฏูุงูโูุง ูุนุงููุงุช
                    signals_result = formatter.send_trading_signals()
                    logger.info(f"ูุชุฌู ุงุฑุณุงู ุณฺฏูุงูโูุง: {signals_result}")
                    
                    last_report_time = now
                    report_count += 1
                except Exception as e:
                    logger.error(f"ุฎุทุง ุฏุฑ ุงุฑุณุงู ฺฏุฒุงุฑุด: {str(e)}")
            
            # ุจุฑุฑุณ ุฒูุงู ุงุฑุณุงู ูพุงู ุฒูุฏู ุจูุฏู (ูุฑ ถ ุณุงุนุช)
            if now - last_alive_time >= timedelta(hours=6):
                logger.info("ุงุฑุณุงู ูพุงู ุฒูุฏู ุจูุฏู ุณุณุชู")
                
                try:
                    current_time = now.strftime("%Y-%m-%d %H:%M:%S")
                    message = f"""
๐ค <b>Crypto Barzin - ูุถุนุช ุณุณุชู</b>
โโโโโโโโโโโโโโโโโโ

ุณุณุชู ฺฏุฒุงุฑุดโุฏู ุฑู ุณุฑูุฑ ุฎุงุฑุฌ ุฏุฑ ุญุงู ุงุฌุฑุง ุงุณุช.
ุชุง ฺฉููู {report_count-1} ฺฏุฒุงุฑุด ุงุฑุณุงู ุดุฏู ุงุณุช.

โฐ <b>ุฒูุงู ฺฉููู:</b> {current_time}

ฺฏุฒุงุฑุดโูุง ุงุตู ูุฑ ณฐ ุฏููู ฺฉุจุงุฑ ุงุฑุณุงู ูโุดููุฏ.
                    """
                    
                    alive_result = telegram.send_message(text=message, parse_mode="HTML")
                    logger.info(f"ูุชุฌู ุงุฑุณุงู ูพุงู ุฒูุฏู ุจูุฏู: {alive_result}")
                    
                    last_alive_time = now
                except Exception as e:
                    logger.error(f"ุฎุทุง ุฏุฑ ุงุฑุณุงู ูพุงู ุฒูุฏู ุจูุฏู: {str(e)}")
            
            # ุงูุชุธุงุฑ ุจุฑุง ฺฉ ุฏููู
            time.sleep(60)
            
    except KeyboardInterrupt:
        logger.info("ุณุฑูุณ ุจุง ุฏุณุชูุฑ ฺฉุงุฑุจุฑ ูุชููู ุดุฏ")
    except Exception as e:
        logger.error(f"ุฎุทุง ุฏุฑ ุงุฌุฑุง ุณุฑูุณ: {str(e)}")
        raise

if __name__ == "__main__":
    run_telegram_service()
```

### ฒ. ุณุงุฎุช Dockerfile

ุณูพุณ ฺฉ ูุงู `Dockerfile` ุงุฌุงุฏ ฺฉูุฏ:

```Dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["python", "telegram_service.py"]
```

### ณ. ุณุงุฎุช ูุงู requirements.txt

```
python-telegram-bot>=14.0
matplotlib
mplfinance
numpy
pandas
ccxt
requests
```

### ด. ุณุงุฎุช ูุงู ูุชุบุฑูุง ูุญุท (.env)

```
TELEGRAM_BOT_TOKEN=7429658178:AAFc8hfXeog2Cu8EWOcXQbMc5Nn-q-f1ePk
DEFAULT_CHAT_ID=722627622
```

### ต. ุณุงุฎุช ูุงู fly.toml

```toml
app = "crypto-barzin"
primary_region = "yyz"  # Toronto

[env]
  TELEGRAM_BOT_TOKEN = "7429658178:AAFc8hfXeog2Cu8EWOcXQbMc5Nn-q-f1ePk"
  DEFAULT_CHAT_ID = "722627622"

[build]

[http_service]
  internal_port = 8080
  force_https = true
  auto_stop_machines = false
  auto_start_machines = true
  min_machines_running = 1
```

### ถ. ุฏุณุชูุฑุงุช ุงุฌุฑุง

```bash
# ูุฑุญูู ฑ: ูุฑูุฏ ุจู ุญุณุงุจ Fly.io
fly auth login

# ูุฑุญูู ฒ: ุฑุงูโุงูุฏุงุฒ ูพุฑูฺู
fly launch

# ูุฑุญูู ณ: ุฏูพูู ุจุฑูุงูู
fly deploy

# ูุฑุญูู ด: ูุดุงูุฏู ูุงฺฏโูุง
fly logs
```

## ูฺฉุงุช ููู

1. ุญุชูุงู ุชูฺฉู ุชูฺฏุฑุงู ู ฺุช ุขุฏ ุฑุง ุฏุฑ ูุงู `.env` ู `fly.toml` ุจู ููุงุฏุฑ ุตุญุญ ุชุบุฑ ุฏูุฏ.
2. ุงุทููุงู ุญุงุตู ฺฉูุฏ ฺฉู ุชูุงู ูุงูโูุง ููุฑุฏ ูุงุฒ (simple_telegram_sender.py, simple_telegram_formatter.py, chart_generator.py) ุฏุฑ ูุณุฑ ุงุตู ูพุฑูฺู ฺฉูพ ุดุฏูโุงูุฏ.
3. ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุญุฏูุฏุชโูุง APIุ ูโุชูุงูุฏ ุงุฒ API Key ูุฎุตูุต CoinGecko ุง ุณุงุฑ ุณุฑูุณโูุง ููุช ุงุณุชูุงุฏู ฺฉูุฏ.

## ูุงูุชูุฑูฺฏ

ุจุฑุง ุงุทููุงู ุงุฒ ูพุงุฏุงุฑ ุณุฑูุณุ ูโุชูุงูุฏ ุงุฒ ุงุจุฒุงุฑูุง ูุงูุชูุฑูฺฏ Fly.io ุงุณุชูุงุฏู ฺฉูุฏ:

```bash
# ูุดุงูุฏู ูุถุนุช ุจุฑูุงูู
fly status

# ูุดุงูุฏู ูุชุฑฺฉโูุง
fly metrics
```