#!/bin/bash

# این اسکریپت تمام سرویس‌های تلگرام را به صورت خودکار راه‌اندازی می‌کند

echo "در حال شروع تمام سرویس‌های تلگرام..."

# شروع سرویس ارسال پیام هر ۱۰ دقیقه
./اجرای_گزارش_دهنده_هر_۱۰_دقیقه.sh

# کمی صبر می‌کنیم تا سرویس‌ها شروع شوند
sleep 3

# شروع ناظر سرویس‌ها
./اجرای_نظارت_تلگرام.sh

echo "تمام سرویس‌های تلگرام شروع شدند."
echo "وضعیت سرویس‌ها:"

# نمایش وضعیت پیام‌دهنده
if [ -f "ten_minute_telegram_sender.pid" ]; then
    pid=$(cat ten_minute_telegram_sender.pid)
    if ps -p $pid > /dev/null; then
        echo "✅ سرویس ارسال پیام هر ۱۰ دقیقه: فعال (PID: $pid)"
    else
        echo "❌ سرویس ارسال پیام هر ۱۰ دقیقه: متوقف"
    fi
else
    echo "❌ سرویس ارسال پیام هر ۱۰ دقیقه: فایل PID یافت نشد"
fi

# نمایش وضعیت ناظر
if [ -f "watchdog.pid" ]; then
    pid=$(cat watchdog.pid)
    if ps -p $pid > /dev/null; then
        echo "✅ ناظر سرویس‌های تلگرام: فعال (PID: $pid)"
    else
        echo "❌ ناظر سرویس‌های تلگرام: متوقف"
    fi
else
    echo "❌ ناظر سرویس‌های تلگرام: فایل PID یافت نشد"
fi

echo ""
echo "برای توقف تمام سرویس‌ها از دستور ./توقف_همه_سرویس_های_تلگرام.sh استفاده کنید."