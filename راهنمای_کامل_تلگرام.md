# راهنمای کامل سیستم پیام‌رسانی تلگرام Crypto Barzin

## مقدمه

سیستم پیام‌رسانی تلگرام Crypto Barzin برای ارسال خودکار اطلاعات بازار ارزهای دیجیتال طراحی شده است. این سیستم قابلیت ارسال گزارش‌های دوره‌ای و سیگنال‌های معاملاتی را دارد.

## چالش‌ها و راه‌حل‌ها

به دلیل محدودیت‌های محیط Replit در نگهداری فرآیندهای پس‌زمینه، ما چند راه‌حل مختلف ایجاد کرده‌ایم:

1. **ارسال مستقیم HTTP**: به جای استفاده از کتابخانه python-telegram-bot، از درخواست‌های HTTP مستقیم استفاده می‌کنیم.
2. **سیستم گزارش‌دهنده هر 10 دقیقه**: یک سرویس ساده که هر 10 دقیقه گزارش‌های قیمت را ارسال می‌کند.
3. **سیستم نظارت**: یک سیستم نظارت که هر ساعت وضعیت سرویس گزارش‌دهنده را بررسی و در صورت نیاز آن را دوباره راه‌اندازی می‌کند.
4. **اسکریپت‌های راه‌اندازی و توقف**: اسکریپت‌های ساده برای مدیریت سرویس‌ها.

## مؤلفه‌های اصلی سیستم

### 1. سرویس گزارش‌دهنده هر 10 دقیقه
- **فایل اصلی**: `ten_minute_telegram_sender.py`
- **عملکرد**: هر 10 دقیقه گزارش قیمت‌های بازار را ارسال می‌کند
- **اسکریپت راه‌اندازی**: `اجرای_گزارش_دهنده_هر_۱۰_دقیقه.sh`
- **اسکریپت توقف**: `توقف_گزارش_دهنده_هر_۱۰_دقیقه.sh`
- **راهنما**: `راهنمای_گزارش_دهنده_هر_۱۰_دقیقه.md`

### 2. سیستم نظارت
- **فایل اصلی**: `telegram_service_watchdog.py`
- **عملکرد**: هر ساعت وضعیت سرویس گزارش‌دهنده را بررسی می‌کند
- **اسکریپت راه‌اندازی**: `اجرای_نظارت_تلگرام.sh`
- **اسکریپت توقف**: `توقف_نظارت_تلگرام.sh`
- **راهنما**: `راهنمای_نظارت_تلگرام.md`

### 3. مدیریت یکپارچه
- **اسکریپت راه‌اندازی همه سرویس‌ها**: `اجرای_خودکار_همه_سرویس_های_تلگرام.sh`
- **اسکریپت توقف همه سرویس‌ها**: `توقف_همه_سرویس_های_تلگرام.sh`

## راه‌اندازی و استفاده

### راه‌اندازی کامل سیستم

برای راه‌اندازی کل سیستم پیام‌رسانی تلگرام با یک دستور:

```bash
./اجرای_خودکار_همه_سرویس_های_تلگرام.sh
```

این دستور:
1. ابتدا سرویس گزارش‌دهنده هر 10 دقیقه را راه‌اندازی می‌کند
2. سپس سیستم نظارت را راه‌اندازی می‌کند
3. وضعیت کلی سیستم را گزارش می‌دهد

### توقف کامل سیستم

برای توقف کل سیستم پیام‌رسانی تلگرام:

```bash
./توقف_همه_سرویس_های_تلگرام.sh
```

### راه‌اندازی یا توقف جداگانه هر مؤلفه

اگر می‌خواهید فقط یک مؤلفه را راه‌اندازی یا متوقف کنید:

**برای سرویس گزارش‌دهنده هر 10 دقیقه**:
```bash
./اجرای_گزارش_دهنده_هر_۱۰_دقیقه.sh
./توقف_گزارش_دهنده_هر_۱۰_دقیقه.sh
```

**برای سیستم نظارت**:
```bash
./اجرای_نظارت_تلگرام.sh
./توقف_نظارت_تلگرام.sh
```

## پیکربندی سیستم

### تنظیم توکن بات و چت آیدی

برای تغییر توکن بات تلگرام یا چت آیدی، فایل‌های زیر را ویرایش کنید:

1. **ten_minute_telegram_sender.py**: متغیرهای `TOKEN` و `CHAT_ID` در ابتدای فایل
2. **super_simple_telegram.py**: متغیرهای مشابه در ابتدای فایل

### تغییر فاصله زمانی ارسال گزارش‌ها

برای تغییر فاصله زمانی ارسال گزارش‌ها:

1. در فایل `ten_minute_telegram_sender.py` مقدار `time.sleep(600)` را تغییر دهید (600 ثانیه = 10 دقیقه)

### تغییر فاصله زمانی نظارت

برای تغییر فاصله زمانی بررسی وضعیت سرویس:

1. در فایل `telegram_service_watchdog.py` مقدار `time.sleep(3600)` را تغییر دهید (3600 ثانیه = 1 ساعت)

## عیب‌یابی

### مشکلات رایج

1. **پیام‌ها ارسال نمی‌شوند**:
   - بررسی کنید که توکن بات و چت آیدی صحیح باشند
   - بررسی کنید که بات در چت یا گروه مورد نظر افزوده شده باشد
   - برای چت‌های شخصی، چت را با بات شروع کنید (دستور /start)
   - فایل‌های لاگ را بررسی کنید

2. **سرویس‌ها متوقف می‌شوند**:
   - سیستم نظارت باید به طور خودکار سرویس گزارش‌دهنده را در صورت توقف دوباره راه‌اندازی کند
   - اگر هر دو سرویس متوقف شده‌اند، از دستور `./اجرای_خودکار_همه_سرویس_های_تلگرام.sh` استفاده کنید
   - در محیط Replit، این رفتار طبیعی است. برای استفاده پایدار، سیستم را روی یک سرور خارجی میزبانی کنید

### بررسی وضعیت سیستم

برای بررسی وضعیت فعلی سیستم:

```bash
# بررسی فرآیندهای در حال اجرا
ps aux | grep telegram

# بررسی لاگ‌های سرویس گزارش‌دهنده
cat ten_minute_telegram_sender.log

# بررسی لاگ‌های سیستم نظارت
cat telegram_service_watchdog.log

# بررسی فایل‌های PID
cat ten_minute_telegram_sender.pid
cat telegram_service_watchdog.pid
```

## راه‌اندازی روی سرور خارجی

برای راه‌اندازی این سیستم روی یک سرور خارجی:

1. **کپی فایل‌ها**:
   - همه فایل‌های اصلی را روی سرور خارجی کپی کنید
   - فایل‌های اصلی شامل: `ten_minute_telegram_sender.py`, `telegram_service_watchdog.py`, `super_simple_telegram.py`
   - اسکریپت‌های راه‌اندازی و توقف را هم کپی کنید

2. **تنظیم دسترسی اجرا**:
   ```bash
   chmod +x *.sh
   ```

3. **راه‌اندازی سیستم**:
   ```bash
   ./اجرای_خودکار_همه_سرویس_های_تلگرام.sh
   ```

## توصیه‌های نهایی

1. **محیط Replit**: در محیط Replit، حتی با وجود سیستم نظارت، ممکن است سرویس‌ها به طور کامل متوقف شوند. راه‌حل بهتر، استفاده از یک سرور خارجی است.

2. **تست منظم**: به طور منظم عملکرد سیستم را بررسی کنید تا از ارسال مداوم پیام‌ها اطمینان حاصل کنید.

3. **لاگ‌های سیستم**: لاگ‌ها را به طور منظم بررسی کنید تا از عملکرد صحیح سیستم مطمئن شوید.

4. **پیکربندی توکن**: اطمینان حاصل کنید که توکن بات و چت آیدی به درستی تنظیم شده‌اند.

برای اطلاعات بیشتر و جزئیات دقیق‌تر هر مؤلفه، به راهنماهای جداگانه مراجعه کنید:
- `راهنمای_گزارش_دهنده_هر_۱۰_دقیقه.md`
- `راهنمای_نظارت_تلگرام.md`