# راهنمای کامل سیستم تلگرام Crypto Barzin

## مقدمه

این سیستم برای ارسال خودکار گزارش‌های قیمت و وضعیت به تلگرام طراحی شده است. این سیستم به صورت خودکار هر ۱۰ دقیقه یک گزارش قیمت و هر ۶ ساعت یک گزارش وضعیت سیستم ارسال می‌کند.

## اجزای سیستم

سیستم تلگرام از چندین بخش تشکیل شده است:

1. **API اندپوینت‌ها**: این اندپوینت‌ها در main.py تعریف شده‌اند و امکان ارسال پیام‌های مختلف به تلگرام را فراهم می‌کنند.

2. **ماژول ارسال پیام**: replit_telegram_sender.py برای ارسال پیام به تلگرام استفاده می‌شود.

3. **سرویس ارسال پیام هر ۱۰ دقیقه**: ten_minute_telegram_sender.py هر ۱۰ دقیقه یک گزارش قیمت و هر ۶ ساعت یک گزارش وضعیت سیستم ارسال می‌کند.

4. **ناظر سرویس‌ها**: telegram_service_watchdog.py وضعیت سرویس‌ها را بررسی می‌کند و در صورت نیاز آن‌ها را مجدداً راه‌اندازی می‌کند.

5. **اسکریپت‌های مدیریت سرویس**: اسکریپت‌های شل برای راه‌اندازی و توقف سرویس‌ها.

6. **ورک‌فلوی Replit**: telegram_replit_workflow.py برای اجرا به عنوان یک ورک‌فلو در Replit.

7. **پنل کنترل وب**: صفحه وب برای مدیریت دستی ارسال پیام‌ها.

## راه‌اندازی سیستم

برای راه‌اندازی کامل سیستم، دستور زیر را اجرا کنید:

```bash
./اجرای_خودکار_همه_سرویس_های_تلگرام.sh
```

این دستور تمام سرویس‌های لازم را راه‌اندازی می‌کند.

## توقف سیستم

برای توقف کامل سیستم، دستور زیر را اجرا کنید:

```bash
./توقف_همه_سرویس_های_تلگرام.sh
```

## مدیریت جداگانه سرویس‌ها

### سرویس ارسال پیام هر ۱۰ دقیقه

برای راه‌اندازی:

```bash
./اجرای_گزارش_دهنده_هر_۱۰_دقیقه.sh
```

برای توقف:

```bash
./توقف_گزارش_دهنده_هر_۱۰_دقیقه.sh
```

### ناظر سرویس‌ها

برای راه‌اندازی:

```bash
./اجرای_نظارت_تلگرام.sh
```

برای توقف:

```bash
./توقف_نظارت_تلگرام.sh
```

## مدیریت دستی از طریق وب

شما می‌توانید از طریق مرورگر وب به آدرس زیر مراجعه کنید و پیام‌ها را به صورت دستی ارسال نمایید:

```
http://localhost:5000/telegram_control
```

یا در محیط Replit:

```
https://[YOUR-REPL-ID].id.repl.co/telegram_control
```

## کاربرد در Replit Workflows

برای استفاده به عنوان یک Workflow در Replit، از اسکریپت `telegram_replit_workflow.py` استفاده کنید. این اسکریپت را می‌توانید به عنوان یک Workflow تنظیم کنید تا به صورت خودکار اجرا شود.

## عیب‌یابی

### وضعیت سرویس‌ها

برای بررسی وضعیت سرویس‌ها، دستور زیر را اجرا کنید:

```bash
ps aux | grep -E "ten_minute_telegram_sender.py|telegram_service_watchdog.py" | grep -v grep
```

### فایل‌های لاگ

برای بررسی لاگ‌های سیستم، فایل‌های زیر را بررسی کنید:

- `ten_minute_telegram_sender.log`: لاگ سرویس ارسال پیام هر ۱۰ دقیقه
- `watchdog.log`: لاگ ناظر سرویس‌ها

### مشکلات رایج

1. **سرویس‌ها اجرا نمی‌شوند**: اطمینان حاصل کنید که اسکریپت‌ها قابل اجرا هستند (chmod +x).

2. **پیام‌ها ارسال نمی‌شوند**: مطمئن شوید که توکن بات و چت آیدی تلگرام به درستی تنظیم شده‌اند.

3. **خطای مربوط به فایل PID**: اگر فایل PID وجود دارد اما سرویس اجرا نمی‌شود، فایل PID را حذف کنید.

## تنظیمات متغیرهای محیطی

برای تنظیم آدرس برنامه در محیط Replit، متغیر محیطی APP_URL را تنظیم کنید:

```bash
export APP_URL="https://YOUR-REPL-ID.id.repl.co"
```

## پیکربندی

تنظیمات پیکربندی در فایل‌های زیر قرار دارند:

- `replit_telegram_sender.py`: تنظیمات مربوط به ارسال پیام
- `ten_minute_telegram_sender.py`: تنظیمات مربوط به سرویس ارسال پیام هر ۱۰ دقیقه
- `telegram_service_watchdog.py`: تنظیمات مربوط به ناظر سرویس‌ها