{% extends "minimal_base.html" %}

{% block title %}ارزهای دیجیتال | ربات هوشمند ارز دیجیتال{% endblock %}

{% block content %}
<!-- Header with creator information -->
<div style="background-color: #FFD700; color: #000; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; font-size: 24px; font-weight: bold;">
    ربات مشاور ارزهای دیجیتال | طراحی و توسعه: حمید برزین
</div>

<div class="row mb-3">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <h1 class="mb-0">ارزهای دیجیتال</h1>
        </div>
        <p class="text-muted mt-2">لیست کامل ارزهای دیجیتال تحت نظارت و تحلیل ربات</p>
    </div>
</div>
<div id="dashboard-content">

    <!-- Cryptocurrency Categories -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card crypto-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">دسته‌بندی ارزها</h5>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-sm btn-warning active" data-crypto-category="all">همه ارزها</button>
                        <button type="button" class="btn btn-sm btn-outline-warning" data-crypto-category="major">ارزهای مهم بازار</button>
                        <button type="button" class="btn btn-sm btn-outline-warning" data-crypto-category="promising">ارزهای هوش مصنوعی</button>
                        <button type="button" class="btn btn-sm btn-outline-warning" data-crypto-category="new">ارزهای لایر 1 و 2</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">ارز</th>
                                    <th scope="col">نماد</th>
                                    <th scope="col">قیمت (USDT)</th>
                                    <th scope="col">تغییر (24h)</th>
                                    <th scope="col">حجم (24h)</th>
                                    <th scope="col">سیگنال</th>
                                    <th scope="col">تحلیل</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- لیست ارزهای دیجیتال با استفاده از داده‌های دینامیک -->
                                {% for coin in cryptocurrencies %}
                                {% if coin.id <= 7 %}
                                <tr class="crypto-row major">
                                {% elif coin.id <= 13 %}
                                <tr class="crypto-row promising">
                                {% else %}
                                <tr class="crypto-row new">
                                {% endif %}
                                    <td>{{ coin.id }}</td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="icon-circle me-2">
                                                <i class="{{ coin.icon }}"></i>
                                            </div>
                                            <div>{{ coin.name }}</div>
                                        </div>
                                    </td>
                                    <td>{{ coin.symbol }}</td>
                                    <td id="{{ coin.symbol.replace('/', '-') }}-price">{{ coin.price }}</td>
                                    <td id="{{ coin.symbol.replace('/', '-') }}-change" class="{% if coin.change.startswith('+') %}text-success{% else %}text-danger{% endif %}">{{ coin.change }}</td>
                                    <td>{{ coin.volume }}</td>
                                    <td><span class="badge bg-{{ coin.signal_class }}">{{ coin.signal }}</span></td>
                                    <td><a href="#" class="btn btn-sm btn-outline-primary analysis-button">تحلیل فنی</a></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Technical Analysis for Selected Crypto -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card crypto-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">تحلیل تکنیکال <span id="selected-crypto-name">بیت‌کوین</span></h5>
                    <div class="border rounded p-1 bg-dark">
                        <button onclick="document.getElementById('technical-analysis-content').style.display='block'; document.getElementById('news-analysis-content').style.display='none';" class="btn btn-sm btn-outline-primary mx-1">تحلیل فنی</button>
                        <button onclick="document.getElementById('technical-analysis-content').style.display='none'; document.getElementById('news-analysis-content').style.display='block';" class="btn btn-sm btn-primary mx-1">اخبار و تحلیل‌ها</button>
                    </div>
                </div>
                <div class="card-body">
                    <!-- بخش تحلیل تکنیکال -->
                    <div id="technical-analysis-content">
                        <!-- نمایش وضعیت بارگذاری -->
                        <div id="technical-loading" style="display: none;">
                            <div class="text-center my-5">
                                <div class="spinner-border text-warning" role="status">
                                    <span class="visually-hidden">در حال بارگذاری...</span>
                                </div>
                                <p class="mt-2 text-muted">در حال دریافت تحلیل فنی <span id="selected-crypto-symbol2">BTC/USDT</span>...</p>
                            </div>
                        </div>
                        
                        <!-- محتوای تحلیل فنی -->
                        <div id="technical-content">
                            <div class="row">
                                <div class="col-md-8">
                                    <!-- Chart Placeholder -->
                                    <div class="chart-container" style="height: 300px; background: #1c1c28; border-radius: 8px;">
                                        <div class="d-flex justify-content-center align-items-center h-100">
                                            <p class="text-muted">نمودار قیمت <span id="selected-crypto-symbol">BTC/USDT</span> به زودی بارگذاری خواهد شد</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="indicator-box mb-3">
                                        <div class="indicator-label">RSI (شاخص قدرت نسبی)</div>
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 65%;" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <small class="text-muted">اشباع فروش</small>
                                            <small class="text-muted">خنثی</small>
                                            <small class="text-muted">اشباع خرید</small>
                                        </div>
                                        <div class="indicator-value">65</div>
                                    </div>
                                
                                <div class="indicator-box mb-3">
                                    <div class="indicator-label">MACD</div>
                                    <div class="d-flex justify-content-between">
                                        <div>سیگنال: <span class="text-info">12.2</span></div>
                                        <div>خط MACD: <span class="text-warning">15.8</span></div>
                                    </div>
                                    <div class="indicator-description">
                                        <span class="text-success">
                                            <i class="fas fa-arrow-up me-1"></i>
                                            روند صعودی (سیگنال خرید)
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="indicator-box">
                                    <div class="indicator-label">میانگین‌های متحرک</div>
                                    <div class="d-flex justify-content-between mt-2">
                                        <div>MA20: <span class="text-info">63,200</span></div>
                                        <div>MA50: <span class="text-warning">61,500</span></div>
                                    </div>
                                    <div class="indicator-description">
                                        <span class="text-success">
                                            <i class="fas fa-check-circle me-1"></i>
                                            قیمت بالای میانگین‌های متحرک (روند صعودی)
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- بخش اخبار و تحلیل‌ها -->
                    <div id="news-analysis-content" style="display: block;">
                        <h6 class="border-bottom pb-2 mb-3">آخرین اخبار مرتبط با <span id="selected-crypto-name2">بیت‌کوین</span></h6>
                        <div class="news-container">
                            <div class="news-item mb-3 p-3 border-start border-4 border-primary">
                                <h6 class="news-title mb-2">بیت‌کوین به بالاترین قیمت تاریخ خود رسید</h6>
                                <p class="news-excerpt text-muted mb-1">ارز دیجیتال بیت‌کوین با عبور از مرز ۷۰ هزار دلار به بالاترین قیمت تاریخ خود دست یافت. این اتفاق در پی افزایش تقاضا از سوی صندوق‌های ETF رخ داده است.</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="news-source">منبع: خبرگزاری ارز دیجیتال</small>
                                    <small class="news-date">۸ آوریل ۲۰۲۵</small>
                                </div>
                                <div class="news-sentiment mt-2">
                                    <span class="badge bg-success">احساس بازار: مثبت</span>
                                </div>
                            </div>
                            
                            <div class="news-item mb-3 p-3 border-start border-4 border-warning">
                                <h6 class="news-title mb-2">تحلیل‌گران: احتمال اصلاح کوتاه‌مدت در قیمت بیت‌کوین</h6>
                                <p class="news-excerpt text-muted mb-1">برخی تحلیل‌گران معتقدند پس از رشد اخیر، بیت‌کوین ممکن است یک اصلاح قیمت موقت را تجربه کند. شاخص‌های تکنیکال نشان می‌دهند بازار در وضعیت اشباع خرید قرار دارد.</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="news-source">منبع: تحلیل‌گران بازار</small>
                                    <small class="news-date">۷ آوریل ۲۰۲۵</small>
                                </div>
                                <div class="news-sentiment mt-2">
                                    <span class="badge bg-warning">احساس بازار: خنثی</span>
                                </div>
                            </div>
                            
                            <div class="news-item mb-3 p-3 border-start border-4 border-info">
                                <h6 class="news-title mb-2">استراتژی معامله هدفمند: زمان مناسب برای ورود به بازار</h6>
                                <p class="news-excerpt text-muted mb-1">با توجه به تثبیت قیمت بیت‌کوین در بالای سطح ۶۵ هزار دلار، بسیاری از معامله‌گران این محدوده را برای ورود به بازار مناسب می‌دانند. استراتژی خرید تدریجی می‌تواند ریسک را کاهش دهد.</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="news-source">منبع: دنیای رمزارز</small>
                                    <small class="news-date">۶ آوریل ۲۰۲۵</small>
                                </div>
                                <div class="news-sentiment mt-2">
                                    <span class="badge bg-info">احساس بازار: محتاطانه مثبت</span>
                                </div>
                            </div>
                        </div>
                        
                        <a href="#" class="btn btn-outline-secondary btn-sm mt-2 w-100" id="load-more-news" onclick="loadMoreNews(); return false;">
                            <i class="fas fa-sync me-1"></i> بارگذاری اخبار بیشتر
                        </a>
                        
<script>
// تابع بارگذاری اخبار بیشتر
function loadMoreNews() {
    const loadMoreButton = document.getElementById('load-more-news');
    const newsContainer = document.querySelector('.news-container');
    
    if (loadMoreButton && newsContainer) {
        // نمایش حالت بارگذاری
        loadMoreButton.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> در حال بارگذاری...';
        
        // شبیه‌سازی تأخیر در بارگذاری (در نسخه واقعی با درخواست API جایگزین می‌شود)
        setTimeout(() => {
            // افزودن خبر جدید
            const newNewsItem = document.createElement('div');
            newNewsItem.className = 'news-item mb-3 p-3 border-start border-4 border-success';
            newNewsItem.innerHTML = `
                <h6 class="news-title mb-2">گزارش: سرمایه‌گذاری نهادی در رمزارزها افزایش یافته است</h6>
                <p class="news-excerpt text-muted mb-1">گزارش‌ها حاکی از آن است که سرمایه‌گذاری نهادی در بازار رمزارزها، خصوصاً بیت‌کوین و اتریوم به شدت افزایش یافته است. این روند می‌تواند نشانه‌ای از پذیرش گسترده‌تر ارزهای دیجیتال باشد.</p>
                <div class="d-flex justify-content-between align-items-center">
                    <small class="news-source">منبع: تحلیل مالی کریپتو</small>
                    <small class="news-date">۵ آوریل ۲۰۲۵</small>
                </div>
                <div class="news-sentiment mt-2">
                    <span class="badge bg-success">احساس بازار: بسیار مثبت</span>
                </div>
            `;
            
            newsContainer.appendChild(newNewsItem);
            
            // بازگرداندن دکمه به حالت اصلی
            loadMoreButton.innerHTML = '<i class="fas fa-sync me-1"></i> بارگذاری اخبار بیشتر';
        }, 1000);
    }
}
</script>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // تابع قالب‌بندی قیمت
    function formatPrice(price) {
        if (price === null || price === undefined || isNaN(price)) {
            return '--';
        }
        
        // اگر قیمت بزرگ است (بدون اعشار)
        if (price >= 1000) {
            return price.toLocaleString('en-US', {maximumFractionDigits: 0});
        }
        
        // اگر قیمت کوچک است (اعشار بیشتر لازم است)
        if (price < 0.01) {
            return price.toLocaleString('en-US', {minimumFractionDigits: 6, maximumFractionDigits: 6});
        }
        
        // حالت پیش‌فرض: 2 رقم اعشار
        return price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
    }
    
    // تابع برای دریافت تحلیل فنی از API
    function loadTechnicalData(symbol) {
        // نمایش وضعیت بارگذاری
        const loadingEl = document.getElementById('technical-loading');
        const contentEl = document.getElementById('technical-content');
        
        if (loadingEl && contentEl) {
            loadingEl.style.display = 'block';
            contentEl.style.display = 'none';
        }
        
        // درخواست به API
        fetch(`/api/technical/${symbol}/1d`)
            .then(response => response.json())
            .then(data => {
                if (data.success && data.data) {
                    const analysis = data.data;
                    
                    // به‌روزرسانی RSI
                    if (analysis.rsi !== undefined) {
                        const rsiEl = document.querySelector('.indicator-box:nth-child(1) .indicator-value');
                        const rsiProgressEl = document.querySelector('.indicator-box:nth-child(1) .progress-bar');
                        
                        if (rsiEl) {
                            rsiEl.textContent = analysis.rsi.toFixed(1);
                        }
                        
                        if (rsiProgressEl) {
                            rsiProgressEl.style.width = `${analysis.rsi}%`;
                            
                            // تغییر رنگ بر اساس مقدار
                            rsiProgressEl.classList.remove('bg-success', 'bg-danger', 'bg-warning');
                            if (analysis.rsi < 30) {
                                rsiProgressEl.classList.add('bg-danger');
                            } else if (analysis.rsi > 70) {
                                rsiProgressEl.classList.add('bg-success');
                            } else {
                                rsiProgressEl.classList.add('bg-warning');
                            }
                        }
                    }
                    
                    // به‌روزرسانی MACD
                    if (analysis.macd !== undefined && analysis.macd_signal !== undefined) {
                        const macdEl = document.querySelector('.indicator-box:nth-child(2) .text-warning');
                        const signalEl = document.querySelector('.indicator-box:nth-child(2) .text-info');
                        const macdDescEl = document.querySelector('.indicator-box:nth-child(2) .indicator-description span');
                        
                        if (macdEl) {
                            macdEl.textContent = analysis.macd.toFixed(2);
                        }
                        
                        if (signalEl) {
                            signalEl.textContent = analysis.macd_signal.toFixed(2);
                        }
                        
                        if (macdDescEl) {
                            if (analysis.macd > analysis.macd_signal) {
                                macdDescEl.innerHTML = '<i class="fas fa-arrow-up me-1"></i> روند صعودی (سیگنال خرید)';
                                macdDescEl.className = 'text-success';
                            } else {
                                macdDescEl.innerHTML = '<i class="fas fa-arrow-down me-1"></i> روند نزولی (سیگنال فروش)';
                                macdDescEl.className = 'text-danger';
                            }
                        }
                    }
                    
                    // به‌روزرسانی میانگین‌های متحرک
                    if (analysis.ma20 !== undefined && analysis.ma50 !== undefined) {
                        const ma20El = document.querySelector('.indicator-box:nth-child(3) .text-info');
                        const ma50El = document.querySelector('.indicator-box:nth-child(3) .text-warning');
                        const maDescEl = document.querySelector('.indicator-box:nth-child(3) .indicator-description span');
                        
                        if (ma20El) {
                            ma20El.textContent = formatPrice(analysis.ma20);
                        }
                        
                        if (ma50El) {
                            ma50El.textContent = formatPrice(analysis.ma50);
                        }
                        
                        if (maDescEl && analysis.current_price !== undefined) {
                            if (analysis.current_price > analysis.ma20 && analysis.ma20 > analysis.ma50) {
                                maDescEl.innerHTML = '<i class="fas fa-check-circle me-1"></i> قیمت بالای میانگین‌های متحرک (روند صعودی)';
                                maDescEl.className = 'text-success';
                            } else if (analysis.current_price < analysis.ma20 && analysis.ma20 < analysis.ma50) {
                                maDescEl.innerHTML = '<i class="fas fa-times-circle me-1"></i> قیمت زیر میانگین‌های متحرک (روند نزولی)';
                                maDescEl.className = 'text-danger';
                            } else {
                                maDescEl.innerHTML = '<i class="fas fa-minus-circle me-1"></i> قیمت در محدوده میانگین‌های متحرک (روند خنثی)';
                                maDescEl.className = 'text-warning';
                            }
                        }
                    }
                    
                    // نمایش نتیجه و مخفی کردن بارگذاری
                    if (loadingEl && contentEl) {
                        loadingEl.style.display = 'none';
                        contentEl.style.display = 'block';
                    }
                } else {
                    console.error('Error loading technical data:', data.message || 'خطای نامشخص');
                    
                    // مخفی کردن بارگذاری و نمایش پیغام خطا
                    if (loadingEl && contentEl) {
                        loadingEl.style.display = 'none';
                        contentEl.style.display = 'block';
                        contentEl.innerHTML = '<div class="alert alert-danger">خطا در دریافت اطلاعات تحلیل فنی</div>';
                    }
                }
            })
            .catch(error => {
                console.error('Error loading technical data:', error);
                
                // مخفی کردن بارگذاری و نمایش پیغام خطا
                if (loadingEl && contentEl) {
                    loadingEl.style.display = 'none';
                    contentEl.style.display = 'block';
                    contentEl.innerHTML = '<div class="alert alert-danger">خطا در ارتباط با سرور</div>';
                }
            });
    }
    
    // روش ساده برای فیلتر کردن ارزها
    function setupFilterButtons() {
        // انتخاب دکمه‌ها و سطرهای جدول
        const allButton = document.querySelector('[data-crypto-category="all"]');
        const majorButton = document.querySelector('[data-crypto-category="major"]');
        const promisingButton = document.querySelector('[data-crypto-category="promising"]');
        const newButton = document.querySelector('[data-crypto-category="new"]');
        
        const allRows = document.querySelectorAll('.crypto-row');
        const majorRows = document.querySelectorAll('.crypto-row.major');
        const promisingRows = document.querySelectorAll('.crypto-row.promising');
        const newRows = document.querySelectorAll('.crypto-row.new');
        
        console.log('تعداد کل سطرها:', allRows.length);
        console.log('سطرهای ارزهای اصلی:', majorRows.length);
        console.log('سطرهای ارزهای با پتانسیل:', promisingRows.length);
        console.log('سطرهای ارزهای جدید:', newRows.length);
        
        // تابع نمایش دادن یا مخفی کردن سطرها
        function showRows(rowsToShow) {
            // همه سطرها را مخفی کن
            allRows.forEach(row => {
                row.style.display = 'none';
            });
            
            // فقط سطرهای انتخاب شده را نمایش بده
            rowsToShow.forEach(row => {
                row.style.display = '';
            });
        }
        
        // تابع به روزرسانی وضعیت دکمه‌ها
        function updateButtonStates(activeButton) {
            [allButton, majorButton, promisingButton, newButton].forEach(button => {
                button.classList.remove('active');
                button.classList.remove('btn-warning');
                button.classList.add('btn-outline-warning');
            });
            
            activeButton.classList.add('active');
            activeButton.classList.remove('btn-outline-warning');
            activeButton.classList.add('btn-warning');
        }
        
        // اضافه کردن رویداد کلیک برای هر دکمه
        if (allButton) {
            allButton.addEventListener('click', function() {
                updateButtonStates(this);
                showRows(allRows);
            });
        }
        
        if (majorButton) {
            majorButton.addEventListener('click', function() {
                updateButtonStates(this);
                showRows(majorRows);
            });
        }
        
        if (promisingButton) {
            promisingButton.addEventListener('click', function() {
                updateButtonStates(this);
                showRows(promisingRows);
            });
        }
        
        if (newButton) {
            newButton.addEventListener('click', function() {
                updateButtonStates(this);
                showRows(newRows);
            });
        }
    }
    
    // فراخوانی تابع تنظیم دکمه‌های فیلتر
    setupFilterButtons();
    
    // دکمه‌های تحلیل در جدول ارزها
    const tableAnalysisButtons = document.querySelectorAll('td .analysis-button');
    
    // اضافه کردن رویداد کلیک برای نمایش تحلیل فنی
    tableAnalysisButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            
            // دریافت اطلاعات ارز از سطر کلیک شده
            const row = this.closest('tr');
            const cryptoNameElement = row.querySelector('.d-flex > div:nth-child(2)');
            const cryptoSymbolElement = row.querySelector('td:nth-child(3)');
            
            if (cryptoNameElement && cryptoSymbolElement) {
                const cryptoName = cryptoNameElement.textContent;
                const cryptoSymbol = cryptoSymbolElement.textContent;
                
                // به روزرسانی بخش تحلیل
                const nameElement = document.getElementById('selected-crypto-name');
                const symbolElement = document.getElementById('selected-crypto-symbol');
                const nameElement2 = document.getElementById('selected-crypto-name2');
                
                if (nameElement && symbolElement) {
                    nameElement.textContent = cryptoName;
                    symbolElement.textContent = cryptoSymbol;
                    
                    if (nameElement2) {
                        nameElement2.textContent = cryptoName;
                    }
                    
                    // درخواست دریافت تحلیل فنی برای ارز انتخاب شده
                    loadTechnicalData(cryptoSymbol);
                }
                
                // نمایش بخش تحلیل فنی (به جای اخبار)
                document.getElementById('technical-analysis-content').style.display = 'none';
                document.getElementById('news-analysis-content').style.display = 'block';
                
                // اسکرول به بخش تحلیل
                const analysisSection = document.querySelector('.card-header');
                if (analysisSection && analysisSection.textContent.includes('تحلیل تکنیکال')) {
                    analysisSection.scrollIntoView({
                        behavior: 'smooth'
                    });
                } else {
                    // اگر بخش تحلیل پیدا نشد، به انتهای صفحه اسکرول کن
                    window.scrollTo({
                        top: document.body.scrollHeight,
                        behavior: 'smooth'
                    });
                }
            }
        });
    });
    
    // تنظیم دکمه‌های زبانه برای تحلیل فنی / اخبار
    function setupTabs() {
        // تابع نمایش تحلیل فنی
        function showTechnical() {
            const technicalContent = document.getElementById('technical-analysis-content');
            const newsContent = document.getElementById('news-analysis-content');
            const techButton = document.getElementById('show-technical');
            const newsButton = document.getElementById('show-news');
            
            if (technicalContent && newsContent && techButton && newsButton) {
                technicalContent.style.display = 'block';
                newsContent.style.display = 'none';
                
                techButton.classList.add('btn-primary');
                techButton.classList.remove('btn-outline-primary');
                
                newsButton.classList.add('btn-outline-primary');
                newsButton.classList.remove('btn-primary');
                
                console.log('نمایش تحلیل فنی');
            }
        }
        
        // تابع نمایش اخبار
        function showNews() {
            const technicalContent = document.getElementById('technical-analysis-content');
            const newsContent = document.getElementById('news-analysis-content');
            const techButton = document.getElementById('show-technical');
            const newsButton = document.getElementById('show-news');
            
            if (technicalContent && newsContent && techButton && newsButton) {
                technicalContent.style.display = 'none';
                newsContent.style.display = 'block';
                
                techButton.classList.add('btn-outline-primary');
                techButton.classList.remove('btn-primary');
                
                newsButton.classList.add('btn-primary');
                newsButton.classList.remove('btn-outline-primary');
                
                // به‌روزرسانی نام رمزارز در بخش اخبار
                const cryptoName = document.getElementById('selected-crypto-name').textContent;
                const cryptoName2 = document.getElementById('selected-crypto-name2');
                if (cryptoName2) {
                    cryptoName2.textContent = cryptoName;
                }
                
                console.log('نمایش اخبار و تحلیل‌ها');
            }
        }
        
        // تعریف توابع در سطح کلی صفحه
        window.showTechnical = showTechnical;
        window.showNews = showNews;
        
        // اضافه کردن event listener به دکمه‌ها
        const techButton = document.getElementById('show-technical');
        const newsButton = document.getElementById('show-news');
        
        if (techButton) {
            techButton.addEventListener('click', showTechnical);
        }
        
        if (newsButton) {
            newsButton.addEventListener('click', showNews);
        }
    }
    
    // شبیه‌سازی به‌روزرسانی قیمت‌ها (در حالت واقعی با API جایگزین می‌شود)
    function updatePrices() {
        const cryptoPriceElements = document.querySelectorAll('[id$="-price"]');
        const cryptoChangeElements = document.querySelectorAll('[id$="-change"]');
        
        // به‌روزرسانی قیمت‌ها با استفاده از API
        cryptoPriceElements.forEach(el => {
            const domId = el.id;
            const symbol = domId.replace('-price', '');
            if (symbol) {
                fetch(`/api/price/${symbol}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success && data.data) {
                            // به‌روزرسانی قیمت
                            el.textContent = formatPrice(data.data.price);
                            
                            // به‌روزرسانی درصد تغییر (اگر element وجود داشته باشد)
                            const changeEl = document.getElementById(`${symbol}-change`);
                            if (changeEl && data.data.change_24h !== undefined) {
                                const newChange = data.data.change_24h;
                                changeEl.textContent = (newChange >= 0 ? '+' : '') + newChange.toFixed(2) + '%';
                                
                                // به‌روزرسانی رنگ‌ها
                                if (newChange >= 0) {
                                    changeEl.className = 'text-success';
                                } else {
                                    changeEl.className = 'text-danger';
                                }
                            }
                        }
                    })
                    .catch(error => {
                        console.error(`Error fetching price for ${symbol}:`, error);
                    });
            }
        });
    }
    
    // به‌روزرسانی قیمت‌ها هر 5 ثانیه
    setInterval(updatePrices, 5000);
    
    // اجرای توابع اصلی
    setupTabs();
    setTimeout(updatePrices, 1000);
});
</script>
<!-- Creator information -->
<div class="row mt-5">
    <div class="col-12 text-center">
        <p class="text-muted small">
            طراحی و توسعه توسط <span class="text-warning fw-bold">حمید برزین</span> | ۱۴۰۴ &copy;
        </p>
    </div>
</div>
{% endblock %}