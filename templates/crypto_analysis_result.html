{% extends "minimal_base.html" %}

{% block title %}Analysis Results: {{ crypto_name }} | {{ ui_text('title', 'Crypto Barzin') }}{% endblock %}

{% block styles %}
{{ super() }}
<style>
    .result-container {
        max-width: 1000px;
        margin: 0 auto;
    }
    .result-card {
        border-radius: 15px;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
    }
    .result-header {
        background-color: #f8f9fa;
        border-top-left-radius: 15px;
        border-top-right-radius: 15px;
        padding: 2rem 1.5rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }
    .crypto-icon {
        font-size: 3rem;
        width: 80px;
        height: 80px;
        line-height: 80px;
        text-align: center;
        background-color: #e9ecef;
        border-radius: 50%;
        margin-right: 1.5rem;
    }
    .crypto-name {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
    }
    .analysis-badge {
        display: inline-block;
        padding: 0.35rem 0.75rem;
        border-radius: 30px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
        background-color: #e9ecef;
    }
    .analysis-content {
        padding: 2rem;
        line-height: 1.7;
    }
    .market-data-card {
        border-radius: 15px;
        overflow: hidden;
    }
    .price-value {
        font-size: 2rem;
        font-weight: bold;
    }
    .price-change {
        font-weight: 600;
    }
    .price-change.positive {
        color: #198754;
    }
    .price-change.negative {
        color: #dc3545;
    }
    .market-data-row {
        padding: 1rem;
        border-bottom: 1px solid #f1f1f1;
    }
    .market-data-row:last-child {
        border-bottom: none;
    }
    .market-data-label {
        color: #6c757d;
        font-weight: 500;
    }
    .market-data-value {
        font-weight: 600;
    }
    .analysis-section {
        margin-bottom: 1.5rem;
    }
    .analysis-section h4 {
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #f1f1f1;
    }
    .news-item {
        margin-bottom: 1.5rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid #f1f1f1;
    }
    .news-item:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
    }
    .news-date {
        color: #6c757d;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }
    .action-btn {
        padding: 0.75rem 1.5rem;
        border-radius: 30px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="result-container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <a href="{{ url_for('crypto_analysis_home') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i> Back to Analysis
            </a>
        </div>
        
        <!-- Main Result Card -->
        <div class="card result-card">
            <div class="result-header">
                <div class="d-flex align-items-center">
                    <div class="crypto-icon">
                        {% if crypto_name|lower == 'bitcoin' %}
                            <i class="fab fa-bitcoin text-warning"></i>
                        {% elif crypto_name|lower == 'ethereum' %}
                            <i class="fab fa-ethereum text-primary"></i>
                        {% else %}
                            <i class="fas fa-coins text-info"></i>
                        {% endif %}
                    </div>
                    <div>
                        <h1 class="crypto-name">{{ crypto_name }}</h1>
                        <span class="analysis-badge">
                            {% if analysis_type == 'general' %}
                                <i class="fas fa-chart-line me-1"></i> General Analysis
                            {% elif analysis_type == 'technical' %}
                                <i class="fas fa-chart-bar me-1"></i> Technical Analysis
                            {% elif analysis_type == 'fundamental' %}
                                <i class="fas fa-project-diagram me-1"></i> Fundamental Analysis
                            {% elif analysis_type == 'news' %}
                                <i class="fas fa-newspaper me-1"></i> News Analysis
                            {% elif analysis_type == 'price_prediction' %}
                                <i class="fas fa-crystal-ball me-1"></i> Price Prediction
                            {% elif analysis_type == 'trading_strategy' %}
                                <i class="fas fa-exchange-alt me-1"></i> Trading Strategy
                            {% endif %}
                        </span>
                    </div>
                </div>
            </div>
            
            <div class="card-body p-0">
                <!-- Loading State -->
                {% if not analysis_result or not analysis_result.success %}
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary mb-3" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <h4>Analysis in progress...</h4>
                        <p class="text-muted">Please wait while we analyze {{ crypto_name }} data.</p>
                    </div>
                {% else %}
                    <!-- Market Data Summary (if available) -->
                    {% if market_data and market_data.success %}
                        <div class="p-3 bg-light">
                            <div class="row">
                                <div class="col-md-4 text-center py-3">
                                    <div class="price-value">
                                        ${{ "{:,.2f}".format(market_data.current_price) if market_data.current_price else 'N/A' }}
                                    </div>
                                    <div class="price-change {{ 'positive' if market_data.price_change_24h and market_data.price_change_24h > 0 else 'negative' }}">
                                        {% if market_data.price_change_24h %}
                                            {{ "+" if market_data.price_change_24h > 0 else "" }}{{ "%.2f"|format(market_data.price_change_24h) }}% (24h)
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-4 text-center py-3">
                                    <div class="text-muted mb-1">Market Cap</div>
                                    <div class="fw-bold">
                                        {% if market_data.market_cap %}
                                            ${{ "{:,.0f}".format(market_data.market_cap) }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-4 text-center py-3">
                                    <div class="text-muted mb-1">24h Volume</div>
                                    <div class="fw-bold">
                                        {% if market_data.total_volume %}
                                            ${{ "{:,.0f}".format(market_data.total_volume) }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    
                    <!-- Analysis Content -->
                    <div class="analysis-content">
                        {% if analysis_result.analysis %}
                            <div class="analysis-sections">
                                {{ analysis_result.analysis|safe|replace('\n', '<br>')|replace('**', '') }}
                            </div>
                        {% else %}
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i> No analysis data available.
                            </div>
                        {% endif %}
                        
                        <!-- News Section (if available and requested) -->
                        {% if news_data and news_data.success and (analysis_type == 'news' or analysis_type == 'general') %}
                            <div class="analysis-section mt-5">
                                <h4><i class="fas fa-newspaper me-2"></i> Recent News</h4>
                                <div class="news-content">
                                    {{ news_data.news|safe|replace('\n', '<br>')|replace('**', '') }}
                                </div>
                            </div>
                        {% endif %}
                        
                        <!-- Market Stats (if available) -->
                        {% if market_data and market_data.success %}
                            <div class="analysis-section mt-5">
                                <h4><i class="fas fa-chart-pie me-2"></i> Market Statistics</h4>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card market-data-card">
                                            <div class="market-data-row d-flex justify-content-between">
                                                <span class="market-data-label">All-Time High</span>
                                                <span class="market-data-value">
                                                    {% if market_data.all_time_high %}
                                                        ${{ "{:,.2f}".format(market_data.all_time_high) }}
                                                    {% else %}
                                                        N/A
                                                    {% endif %}
                                                </span>
                                            </div>
                                            <div class="market-data-row d-flex justify-content-between">
                                                <span class="market-data-label">7d Change</span>
                                                <span class="market-data-value {{ 'text-success' if market_data.price_change_7d and market_data.price_change_7d > 0 else 'text-danger' }}">
                                                    {% if market_data.price_change_7d %}
                                                        {{ "+" if market_data.price_change_7d > 0 else "" }}{{ "%.2f"|format(market_data.price_change_7d) }}%
                                                    {% else %}
                                                        N/A
                                                    {% endif %}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card market-data-card">
                                            <div class="market-data-row d-flex justify-content-between">
                                                <span class="market-data-label">All-Time Low</span>
                                                <span class="market-data-value">
                                                    {% if market_data.all_time_low %}
                                                        ${{ "{:,.2f}".format(market_data.all_time_low) }}
                                                    {% else %}
                                                        N/A
                                                    {% endif %}
                                                </span>
                                            </div>
                                            <div class="market-data-row d-flex justify-content-between">
                                                <span class="market-data-label">30d Change</span>
                                                <span class="market-data-value {{ 'text-success' if market_data.price_change_30d and market_data.price_change_30d > 0 else 'text-danger' }}">
                                                    {% if market_data.price_change_30d %}
                                                        {{ "+" if market_data.price_change_30d > 0 else "" }}{{ "%.2f"|format(market_data.price_change_30d) }}%
                                                    {% else %}
                                                        N/A
                                                    {% endif %}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
            
            <div class="card-footer text-center py-4">
                <div class="row">
                    <div class="col-md-6 mb-2 mb-md-0">
                        <a href="{{ url_for('crypto_analysis_home') }}" class="btn btn-outline-secondary action-btn">
                            <i class="fas fa-search me-2"></i> Analyze Another Crypto
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="#" class="btn btn-primary action-btn" onclick="window.print(); return false;">
                            <i class="fas fa-print me-2"></i> Print Analysis
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Disclaimer -->
        <div class="alert alert-warning text-center">
            <i class="fas fa-exclamation-triangle me-2"></i> This analysis is provided for informational purposes only and should not be considered financial advice.
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Scroll to the top when the page loads
        window.scrollTo(0, 0);
        
        // Format any numbers and percentages in the analysis text
        const analysisContent = document.querySelector('.analysis-sections');
        if (analysisContent) {
            // Replace dollar amounts with formatted values
            const content = analysisContent.innerHTML;
            analysisContent.innerHTML = content
                .replace(/\$(\d+(\.\d+)?)(billion|B)?/g, function(match, num, decimal, suffix) {
                    if (suffix) {
                        return '$' + (parseFloat(num) * 1000000000).toLocaleString() + ' (' + suffix + ')';
                    } else {
                        return '$' + parseFloat(num).toLocaleString();
                    }
                })
                .replace(/(\d+\.\d+)%/g, function(match, num) {
                    const value = parseFloat(num);
                    if (value > 0) {
                        return '<span class="text-success">+' + value + '%</span>';
                    } else if (value < 0) {
                        return '<span class="text-danger">' + value + '%</span>';
                    }
                    return match;
                });
        }
    });
</script>
{% endblock %}