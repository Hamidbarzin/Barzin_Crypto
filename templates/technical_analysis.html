{% extends "base.html" %}

{% block title %}Technical Analysis - {{ symbol }}{% endblock %}

{% block content %}
<!-- Dark background hero banner at the top of the page -->
<div class="container-fluid bg-dark text-white py-4 mb-4">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <h2 class="text-warning">
                        <i class="fas fa-chart-line me-2"></i>
                        {{ name }} <span class="badge bg-light text-dark">{{ symbol }}</span>
                    </h2>
                    <div>
                        <span class="badge bg-light text-dark">Technical Analysis</span>
                    </div>
                </div>
                <p class="text-light mb-0">Last updated: {{ timestamp }}</p>
            </div>
        </div>
    </div>
</div>

<!-- Main content container -->
<div class="container my-4">
    <!-- Navigation breadcrumb below the hero section -->
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/minimal">Home</a></li>
                    <li class="breadcrumb-item"><a href="/cryptocurrencies">Cryptocurrencies</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Technical Analysis - {{ symbol }}</li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-8">
            <!-- Chart Placeholder -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Price Chart</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container" style="height: 300px; background: #1c1c28; border-radius: 8px;">
                        <div class="d-flex justify-content-center align-items-center h-100">
                            <p class="text-muted">Price chart for {{ symbol }} will load soon</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <!-- Price Information -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Current Price</h5>
                </div>
                <div class="card-body">
                    <h2>${{ price }}</h2>
                    <span class="{% if change_24h >= 0 %}text-success{% else %}text-danger{% endif %}">
                        <i class="fas {% if change_24h >= 0 %}fa-caret-up{% else %}fa-caret-down{% endif %}"></i>
                        {{ change_24h|abs|round(2) }}% (24h)
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Technical Indicators</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- RSI -->
                        <div class="col-md-4">
                            <div class="indicator-box mb-3">
                                <div class="indicator-label">RSI (Relative Strength Index)</div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar 
                                        {% if rsi < 30 %}bg-danger
                                        {% elif rsi > 70 %}bg-success
                                        {% else %}bg-warning{% endif %}" 
                                        role="progressbar" 
                                        style="width: {{ rsi }}%;" 
                                        aria-valuenow="{{ rsi }}" 
                                        aria-valuemin="0" 
                                        aria-valuemax="100">
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <small class="text-muted">Oversold</small>
                                    <small class="text-muted">Neutral</small>
                                    <small class="text-muted">Overbought</small>
                                </div>
                                <div class="indicator-value">{{ rsi|round(1) }}</div>
                                <div class="mt-2">
                                    {% if rsi < 30 %}
                                    <span class="text-danger">
                                        <i class="fas fa-arrow-down me-1"></i>
                                        Oversold (Potential buy signal)
                                    </span>
                                    {% elif rsi > 70 %}
                                    <span class="text-success">
                                        <i class="fas fa-arrow-up me-1"></i>
                                        Overbought (Potential sell signal)
                                    </span>
                                    {% else %}
                                    <span class="text-warning">
                                        <i class="fas fa-minus-circle me-1"></i>
                                        Neutral
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- MACD -->
                        <div class="col-md-4">
                            <div class="indicator-box mb-3">
                                <div class="indicator-label">MACD</div>
                                <div class="d-flex justify-content-between">
                                    <div>Signal: <span class="text-info">{{ macd_signal|round(2) }}</span></div>
                                    <div>MACD Line: <span class="text-warning">{{ macd|round(2) }}</span></div>
                                </div>
                                <div class="indicator-description mt-2">
                                    {% if macd > macd_signal %}
                                    <span class="text-success">
                                        <i class="fas fa-arrow-up me-1"></i>
                                        Bullish trend (Buy signal)
                                    </span>
                                    {% else %}
                                    <span class="text-danger">
                                        <i class="fas fa-arrow-down me-1"></i>
                                        Bearish trend (Sell signal)
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Moving Averages -->
                        <div class="col-md-4">
                            <div class="indicator-box mb-3">
                                <div class="indicator-label">Moving Averages</div>
                                <div class="d-flex justify-content-between mt-2">
                                    <div>MA20: <span class="text-info">${{ ma20|round(2) }}</span></div>
                                    <div>MA50: <span class="text-warning">${{ ma50|round(2) }}</span></div>
                                </div>
                                <div class="indicator-description mt-2">
                                    {% if current_price > ma20 and ma20 > ma50 %}
                                    <span class="text-success">
                                        <i class="fas fa-check-circle me-1"></i>
                                        Price above moving averages (Bullish trend)
                                    </span>
                                    {% elif current_price < ma20 and ma20 < ma50 %}
                                    <span class="text-danger">
                                        <i class="fas fa-times-circle me-1"></i>
                                        Price below moving averages (Bearish trend)
                                    </span>
                                    {% else %}
                                    <span class="text-warning">
                                        <i class="fas fa-minus-circle me-1"></i>
                                        Price between moving averages (Neutral trend)
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <!-- Bollinger Bands -->
                        <div class="col-md-4">
                            <div class="indicator-box mb-3">
                                <div class="indicator-label">Bollinger Bands</div>
                                <div class="d-flex justify-content-between mt-2">
                                    <div>Lower: <span class="text-danger">${{ bb_lower|round(2) }}</span></div>
                                    <div>Middle: <span class="text-warning">${{ bb_middle|round(2) }}</span></div>
                                    <div>Upper: <span class="text-success">${{ bb_upper|round(2) }}</span></div>
                                </div>
                                <div class="mt-2">
                                    <small class="text-muted">Width: {{ bb_width|round(4) }}</small>
                                </div>
                                <div class="indicator-description mt-2">
                                    {% if current_price > bb_upper %}
                                    <span class="text-danger">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        Price above upper band (Potential sell signal)
                                    </span>
                                    {% elif current_price < bb_lower %}
                                    <span class="text-success">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        Price below lower band (Potential buy signal)
                                    </span>
                                    {% else %}
                                    <span class="text-warning">
                                        <i class="fas fa-minus-circle me-1"></i>
                                        Price within bands (Neutral)
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Stochastic -->
                        <div class="col-md-4">
                            <div class="indicator-box mb-3">
                                <div class="indicator-label">Stochastic Oscillator</div>
                                <div class="d-flex justify-content-between mt-2">
                                    <div>%K: <span class="text-info">{{ stoch_k|round(2) }}</span></div>
                                    <div>%D: <span class="text-warning">{{ stoch_d|round(2) }}</span></div>
                                </div>
                                <div class="progress mt-2" style="height: 8px;">
                                    <div class="progress-bar 
                                        {% if stoch_k < 20 %}bg-success
                                        {% elif stoch_k > 80 %}bg-danger
                                        {% else %}bg-warning{% endif %}" 
                                        role="progressbar" 
                                        style="width: {{ stoch_k }}%;" 
                                        aria-valuenow="{{ stoch_k }}" 
                                        aria-valuemin="0" 
                                        aria-valuemax="100">
                                    </div>
                                </div>
                                <div class="indicator-description mt-2">
                                    {% if stoch_k < 20 and stoch_k > stoch_d %}
                                    <span class="text-success">
                                        <i class="fas fa-arrow-up me-1"></i>
                                        Oversold with bullish crossover (Buy signal)
                                    </span>
                                    {% elif stoch_k > 80 and stoch_k < stoch_d %}
                                    <span class="text-danger">
                                        <i class="fas fa-arrow-down me-1"></i>
                                        Overbought with bearish crossover (Sell signal)
                                    </span>
                                    {% else %}
                                    <span class="text-warning">
                                        <i class="fas fa-minus-circle me-1"></i>
                                        Neutral territory
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Volume -->
                        <div class="col-md-4">
                            <div class="indicator-box mb-3">
                                <div class="indicator-label">Volume Analysis</div>
                                <div class="d-flex justify-content-between mt-2">
                                    <div>Volume EMA: <span class="text-info">{{ volume_ema|round(2) }}</span></div>
                                </div>
                                <div class="mt-2">
                                    <small class="text-muted">10-day trend: {{ price_trend_10d|round(2) }}%</small>
                                </div>
                                <div class="indicator-description mt-2">
                                    {% if price_trend_10d > 0 %}
                                    <span class="text-success">
                                        <i class="fas fa-arrow-up me-1"></i>
                                        Positive trend over last 10 days
                                    </span>
                                    {% else %}
                                    <span class="text-danger">
                                        <i class="fas fa-arrow-down me-1"></i>
                                        Negative trend over last 10 days
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Trading Signal</h5>
                    <span class="badge 
                        {% if signal == 'خرید قوی' or signal == 'خرید' %}bg-success
                        {% elif signal == 'فروش قوی' or signal == 'فروش' %}bg-danger
                        {% else %}bg-warning{% endif %} bg-gradient">
                        Strength: {{ signal_strength }}
                    </span>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-center">
                        <div class="signal-display p-4 rounded-3 
                            {% if signal == 'خرید قوی' or signal == 'خرید' %}bg-success
                            {% elif signal == 'فروش قوی' or signal == 'فروش' %}bg-danger
                            {% else %}bg-warning{% endif %} bg-opacity-25">
                            <h1 class="display-4 text-center 
                                {% if signal == 'خرید قوی' or signal == 'خرید' %}text-success
                                {% elif signal == 'فروش قوی' or signal == 'فروش' %}text-danger
                                {% else %}text-warning{% endif %}">
                                {% if signal == 'خرید قوی' %}
                                <i class="fas fa-angle-double-up me-2"></i> STRONG BUY
                                {% elif signal == 'خرید' %}
                                <i class="fas fa-angle-up me-2"></i> BUY
                                {% elif signal == 'فروش قوی' %}
                                <i class="fas fa-angle-double-down me-2"></i> STRONG SELL
                                {% elif signal == 'فروش' %}
                                <i class="fas fa-angle-down me-2"></i> SELL
                                {% else %}
                                <i class="fas fa-minus me-2"></i> NEUTRAL
                                {% endif %}
                            </h1>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col text-center">
            <a href="/cryptocurrencies" class="btn btn-primary"><i class="fas fa-arrow-left me-2"></i> Back to All Cryptocurrencies</a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Add any custom JavaScript for the technical analysis page here
    document.addEventListener('DOMContentLoaded', function() {
        console.log("Technical Analysis page loaded for {{ symbol }}");
    });
</script>
{% endblock %}