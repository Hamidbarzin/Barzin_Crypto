{% extends "minimal_base.html" %}

{% block title %}{{ ui_text('dashboard', 'داشبورد') }} | {{ ui_text('title', 'برزین کریپتو') }}{% endblock %}

{% block content %}

<div id="dashboard-content">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="mb-3">{{ ui_text('dashboard', 'داشبورد') }}</h1>
            <p class="text-muted">{{ ui_text('market_overview', 'آخرین تحلیل‌ها، سیگنال‌ها و قیمت‌های بازار ارز دیجیتال') }}</p>
        </div>
    </div>

    <!-- Crypto Price Cards -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card crypto-card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center">
                            <div class="icon-circle me-3">
                                <i class="fab fa-bitcoin text-warning fs-4"></i>
                            </div>
                            <div>
                                <h5 class="card-title mb-0">{{ ui_text('bitcoin', 'بیت‌کوین') }}</h5>
                                <p class="text-muted mb-0">BTC/USDT</p>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-end">
                        <h3 class="mb-0" id="BTC-USDT-price">--</h3>
                        <h5 class="mb-0" id="BTC-USDT-change">--</h5>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card crypto-card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center">
                            <div class="icon-circle me-3">
                                <i class="fab fa-ethereum text-primary fs-4"></i>
                            </div>
                            <div>
                                <h5 class="card-title mb-0">{{ ui_text('ethereum', 'اتریوم') }}</h5>
                                <p class="text-muted mb-0">ETH/USDT</p>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-end">
                        <h3 class="mb-0" id="ETH-USDT-price">--</h3>
                        <h5 class="mb-0" id="ETH-USDT-change">--</h5>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card crypto-card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center">
                            <div class="icon-circle me-3">
                                <i class="fas fa-sun text-success fs-4"></i>
                            </div>
                            <div>
                                <h5 class="card-title mb-0">{{ ui_text('coins.sol', 'سولانا') }}</h5>
                                <p class="text-muted mb-0">SOL/USDT</p>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-end">
                        <h3 class="mb-0" id="SOL-USDT-price">--</h3>
                        <h5 class="mb-0" id="SOL-USDT-change">--</h5>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card crypto-card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center">
                            <div class="icon-circle me-3">
                                <i class="fas fa-chart-line text-info fs-4"></i>
                            </div>
                            <div>
                                <h5 class="card-title mb-0">{{ ui_text('ripple', 'ریپل') }}</h5>
                                <p class="text-muted mb-0">XRP/USDT</p>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-end">
                        <h3 class="mb-0" id="XRP-USDT-price">--</h3>
                        <h5 class="mb-0" id="XRP-USDT-change">--</h5>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Simple Section Switcher instead of tabs -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-center gap-2">
                <button class="btn btn-primary active" id="technical-btn" onclick="switchSection('technical')">
                    <i class="fas fa-chart-bar me-1"></i> {{ ui_text('technical_analysis', 'تحلیل تکنیکال') }}
                </button>
                <button class="btn btn-outline-primary" id="signals-btn" onclick="switchSection('signals')">
                    <i class="fas fa-signal me-1"></i> {{ ui_text('trading_signals', 'سیگنال‌های معاملاتی') }}
                </button>
                <button class="btn btn-outline-primary" id="news-btn" onclick="switchSection('news')">
                    <i class="fas fa-newspaper me-1"></i> {{ ui_text('news', 'اخبار') }}
                </button>
            </div>
        </div>
    </div>
            
    <!-- Section Content Container -->
    <div class="sections-container">
                <!-- Technical Analysis Tab -->
                <div class="tab-pane active" id="technical-pane" role="tabpanel" aria-labelledby="technical-tab">
                    <div class="card crypto-card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">{{ ui_text('technical_analysis_bitcoin', 'تحلیل تکنیکال بیت‌کوین (تایم‌فریم ساعتی)') }}</h5>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-sm btn-secondary active">BTC</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary">ETH</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary">SOL</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary">XRP</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Loading Spinner -->
                            <div id="technical-loading" class="text-center py-5">
                                <span class="loader"></span>
                                <p class="mt-3 text-muted">{{ ui_text('loading_technical_analysis', 'در حال بارگذاری تحلیل تکنیکال...') }}</p>
                            </div>
                            
                            <!-- Technical Analysis Content -->
                            <div id="technical-content" style="display: none;">
                                <!-- Chart Container -->
                                <div class="chart-container mb-4">
                                    <canvas id="priceChart"></canvas>
                                </div>
                                
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="card mb-3 stat-card">
                                            <div class="card-body">
                                                <h5 class="card-title mb-3">شاخص‌های تکنیکال</h5>
                                                <div class="table-responsive">
                                                    <table class="table table-sm">
                                                        <tbody>
                                                            <tr>
                                                                <td><strong>RSI</strong> <small class="text-muted">(14)</small></td>
                                                                <td><span id="rsi-value">--</span></td>
                                                            </tr>
                                                            <tr>
                                                                <td><strong>MACD</strong></td>
                                                                <td><span id="macd-value">--</span></td>
                                                            </tr>
                                                            <tr>
                                                                <td><strong>میانگین متحرک</strong></td>
                                                                <td><span id="ma-value">--</span></td>
                                                            </tr>
                                                            <tr class="table-active">
                                                                <td><strong>سیگنال کلی</strong></td>
                                                                <td><strong id="overall-signal">--</strong></td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="card mb-3 stat-card">
                                            <div class="card-body">
                                                <h5 class="card-title mb-3">سطوح حمایت و مقاومت</h5>
                                                <div class="table-responsive">
                                                    <table class="table table-sm">
                                                        <tbody>
                                                            <tr>
                                                                <td><strong>مقاومت 2</strong></td>
                                                                <td>۶۸,۵۰۰</td>
                                                            </tr>
                                                            <tr>
                                                                <td><strong>مقاومت 1</strong></td>
                                                                <td>۶۶,۸۰۰</td>
                                                            </tr>
                                                            <tr class="table-active">
                                                                <td><strong>قیمت فعلی</strong></td>
                                                                <td>۶۵,۱۲۰</td>
                                                            </tr>
                                                            <tr>
                                                                <td><strong>حمایت 1</strong></td>
                                                                <td>۶۴,۵۰۰</td>
                                                            </tr>
                                                            <tr>
                                                                <td><strong>حمایت 2</strong></td>
                                                                <td>۶۳,۲۰۰</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card mb-3 stat-card">
                                    <div class="card-body">
                                        <h5 class="card-title mb-3">توضیحات تحلیل</h5>
                                        <p>بیت‌کوین در حال حاضر در روند صعودی قرار دارد. شاخص RSI نشان‌دهنده شرایط خریداری بیش از حد (اشباع خرید) است، اما MACD همچنان سیگنال صعودی را نشان می‌دهد. میانگین‌های متحرک حمایت خوبی را در سطح ۶۴,۵۰۰ دلار فراهم می‌کنند.</p>
                                        <p>توصیه می‌شود معامله‌گران صبر کنند تا سیگنال تأییدی بیشتری دریافت کنند یا منتظر اصلاح به سمت سطوح حمایتی باشند.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Trading Signals Tab -->
                <div class="tab-pane" id="signals-pane" role="tabpanel" aria-labelledby="signals-tab" style="display: none;">
                    <!-- Loading Spinner -->
                    <div id="signals-loading" style="display: none;" class="text-center py-5">
                        <span class="loader"></span>
                        <p class="mt-3 text-muted">{{ ui_text('loading_trading_signals', 'در حال بارگذاری سیگنال‌های معاملاتی...') }}</p>
                    </div>
                    
                    <!-- Signals Container -->
                    <div id="signals-container" class="row">
                        <!-- BTC Signal Card -->
                        <div class="col-md-6 mb-4">
                            <div class="card crypto-card h-100">
                                <div class="card-header">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="d-flex align-items-center">
                                            <div class="icon-circle me-2">
                                                <i class="fab fa-bitcoin text-warning"></i>
                                            </div>
                                            <h5 class="mb-0">{{ ui_text('bitcoin', 'بیت‌کوین') }} (BTC/USDT)</h5>
                                        </div>
                                        <span class="badge bg-success">{{ ui_text('buy', 'خرید') }}</span>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <span class="text-muted">{{ ui_text('current_price', 'قیمت فعلی') }}:</span>
                                            <span id="btc-signal-price" class="fw-bold">۶۵,۱۲۰ USDT</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-1">
                                            <span class="text-muted">{{ ui_text('suggested_volume', 'حجم پیشنهادی') }}:</span>
                                            <span class="fw-bold">۰.۵ BTC</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-1">
                                            <span class="text-muted">{{ ui_text('take_profit', 'حد سود') }}:</span>
                                            <span class="text-success">۶۸,۵۰۰ USDT (+۵.۲٪)</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span class="text-muted">{{ ui_text('stop_loss', 'حد ضرر') }}:</span>
                                            <span class="text-danger">۶۲,۸۰۰ USDT (-۳.۶٪)</span>
                                        </div>
                                    </div>
                                    <p class="signal-description">
                                        بیت‌کوین اخیراً یک الگوی مثلث صعودی را تکمیل کرده و به نظر می‌رسد آماده ادامه روند صعودی است. شاخص RSI در ناحیه خنثی قرار دارد و MACD سیگنال خرید را نشان می‌دهد.
                                    </p>
                                    <div class="text-center mt-3">
                                        <button class="btn btn-sm btn-outline-warning me-2">{{ ui_text("share", "اشتراک‌گذاری") }} <i class="fas fa-share-alt ms-1"></i></button>
                                        <button class="btn btn-sm btn-primary">{{ ui_text("buy", "خرید") }} <i class="fas fa-arrow-right ms-1"></i></button>
                                    </div>
                                </div>
                                <div class="card-footer text-muted">
                                    <small>ایجاد شده: امروز ۱۵:۴۵ | اعتبار: ۲۴ ساعت</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ETH Signal Card -->
                        <div class="col-md-6 mb-4">
                            <div class="card crypto-card h-100">
                                <div class="card-header">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="d-flex align-items-center">
                                            <div class="icon-circle me-2">
                                                <i class="fab fa-ethereum text-primary"></i>
                                            </div>
                                            <h5 class="mb-0">{{ ui_text('ethereum', 'اتریوم') }} (ETH/USDT)</h5>
                                        </div>
                                        <span class="badge bg-danger">{{ ui_text('sell', 'فروش') }}</span>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <span class="text-muted">{{ ui_text('current_price', 'قیمت فعلی') }}:</span>
                                            <span id="eth-signal-price" class="fw-bold">۳,۴۵۰ USDT</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-1">
                                            <span class="text-muted">{{ ui_text('suggested_volume', 'حجم پیشنهادی') }}:</span>
                                            <span class="fw-bold">۲ ETH</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-1">
                                            <span class="text-muted">{{ ui_text('take_profit', 'حد سود') }}:</span>
                                            <span class="text-success">۳,۲۳۰ USDT (+۶.۴٪)</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span class="text-muted">{{ ui_text('stop_loss', 'حد ضرر') }}:</span>
                                            <span class="text-danger">۳,۵۸۰ USDT (-۳.۸٪)</span>
                                        </div>
                                    </div>
                                    <p class="signal-description">
                                        {{ ui_text('eth_sell_signal', 'اتریوم در نزدیکی مقاومت کلیدی قرار گرفته و شاخص‌های تکنیکال نشان‌دهنده اشباع خرید هستند. RSI بالای ۷۰ قرار دارد و الگوی واگرایی منفی با MACD مشاهده می‌شود. احتمال اصلاح قیمت وجود دارد.') }}
                                    </p>
                                    <div class="text-center mt-3">
                                        <button class="btn btn-sm btn-outline-warning me-2">{{ ui_text("share", "اشتراک‌گذاری") }} <i class="fas fa-share-alt ms-1"></i></button>
                                        <button class="btn btn-sm btn-danger">{{ ui_text("sell", "فروش") }} <i class="fas fa-arrow-left ms-1"></i></button>
                                    </div>
                                </div>
                                <div class="card-footer text-muted">
                                    <small>{{ ui_text('signal_validity', 'ایجاد شده: امروز {time} | اعتبار: {hours} ساعت').format(time='۱۶:۳۰', hours='۱۲') }}</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- SOL Signal Card -->
                        <div class="col-md-6 mb-4">
                            <div class="card crypto-card h-100">
                                <div class="card-header">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="d-flex align-items-center">
                                            <div class="icon-circle me-2">
                                                <i class="fas fa-sun text-info"></i>
                                            </div>
                                            <h5 class="mb-0">{{ ui_text('solana', 'سولانا') }} (SOL/USDT)</h5>
                                        </div>
                                        <span class="badge bg-success">{{ ui_text('buy', 'خرید') }}</span>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <span class="text-muted">{{ ui_text('current_price', 'قیمت فعلی') }}:</span>
                                            <span class="fw-bold">۱۵۲ USDT</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-1">
                                            <span class="text-muted">{{ ui_text('suggested_volume', 'حجم پیشنهادی') }}:</span>
                                            <span class="fw-bold">۱۰ SOL</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-1">
                                            <span class="text-muted">{{ ui_text('take_profit', 'حد سود') }}:</span>
                                            <span class="text-success">۱۷۵ USDT (+۱۵.۱٪)</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span class="text-muted">{{ ui_text('stop_loss', 'حد ضرر') }}:</span>
                                            <span class="text-danger">۱۳۹ USDT (-۸.۶٪)</span>
                                        </div>
                                    </div>
                                    <p class="signal-description">
                                        {{ ui_text('sol_buy_signal', 'سولانا در حال شکستن یک الگوی مقاومتی کلیدی است و با حجم معاملات بالا در حال حرکت است. میانگین‌های متحرک حمایت قوی را نشان می‌دهند و پتانسیل رشد قابل توجهی وجود دارد.') }}
                                    </p>
                                    <div class="text-center mt-3">
                                        <button class="btn btn-sm btn-outline-warning me-2">{{ ui_text("share", "اشتراک‌گذاری") }} <i class="fas fa-share-alt ms-1"></i></button>
                                        <button class="btn btn-sm btn-primary">{{ ui_text("buy", "خرید") }} <i class="fas fa-arrow-right ms-1"></i></button>
                                    </div>
                                </div>
                                <div class="card-footer text-muted">
                                    <small>{{ ui_text('signal_validity', 'ایجاد شده: امروز {time} | اعتبار: {hours} ساعت').format(time='۱۴:۲۰', hours='۴۸') }}</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- BNB Signal Card -->
                        <div class="col-md-6 mb-4">
                            <div class="card crypto-card h-100">
                                <div class="card-header">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="d-flex align-items-center">
                                            <div class="icon-circle me-2">
                                                <i class="fas fa-coins text-warning"></i>
                                            </div>
                                            <h5 class="mb-0">{{ ui_text('binance_coin', 'بایننس کوین') }} (BNB/USDT)</h5>
                                        </div>
                                        <span class="badge bg-warning">{{ ui_text('wait', 'انتظار') }}</span>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <span class="text-muted">{{ ui_text('current_price', 'قیمت فعلی') }}:</span>
                                            <span class="fw-bold">۵۶۰ USDT</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-1">
                                            <span class="text-muted">{{ ui_text('monitoring_level', 'سطح نظارت') }}:</span>
                                            <span class="fw-bold">۵۸۰ USDT</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-1">
                                            <span class="text-muted">{{ ui_text('price_target_bullish', 'هدف قیمتی (صعودی)') }}:</span>
                                            <span class="text-success">۶۱۵ USDT</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span class="text-muted">{{ ui_text('price_target_bearish', 'هدف قیمتی (نزولی)') }}:</span>
                                            <span class="text-danger">۵۲۰ USDT</span>
                                        </div>
                                    </div>
                                    <p class="signal-description">
                                        {{ ui_text('bnb_wait_signal', 'بایننس کوین در یک محدوده قیمتی باریک در حال معامله است. در صورت شکست سطح مقاومت ۵۸۰ دلار، سیگنال خرید فعال می‌شود. پیشنهاد می‌شود تا زمان شکست این سطح، معامله‌ای انجام نشود.') }}
                                    </p>
                                    <div class="text-center mt-3">
                                        <button class="btn btn-sm btn-outline-warning me-2">{{ ui_text("share", "اشتراک‌گذاری") }} <i class="fas fa-share-alt ms-1"></i></button>
                                        <button class="btn btn-sm btn-secondary">{{ ui_text("set_alert", "تنظیم هشدار") }} <i class="fas fa-bell ms-1"></i></button>
                                    </div>
                                </div>
                                <div class="card-footer text-muted">
                                    <small>{{ ui_text('signal_validity', 'ایجاد شده: امروز {time} | اعتبار: {hours} ساعت').format(time='۱۷:۱۰', hours='۲۴') }}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- News Tab -->
                <div class="tab-pane" id="news-pane" role="tabpanel" aria-labelledby="news-tab" style="display: none;">
                    <!-- Loading Spinner -->
                    <div id="news-loading" class="text-center py-5">
                        <span class="loader"></span>
                        <p class="mt-3 text-muted">{{ ui_text('loading_news', 'در حال بارگذاری اخبار...') }}</p>
                    </div>
                    
                    <!-- News Container -->
                    <div id="news-container"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // تابع تغییر بخش
        window.switchSection = function(sectionName) {
            console.log('Switching to section:', sectionName);
            
            // غیرفعال کردن همه دکمه‌ها
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.id.includes('-btn')) {
                    btn.classList.remove('btn-primary');
                    btn.classList.remove('active');
                    btn.classList.add('btn-outline-primary');
                }
            });
            
            // فعال کردن دکمه انتخاب شده
            const activeBtn = document.getElementById(sectionName + '-btn');
            if (activeBtn) {
                activeBtn.classList.remove('btn-outline-primary');
                activeBtn.classList.add('btn-primary');
                activeBtn.classList.add('active');
            }
            
            // مخفی کردن همه بخش‌ها
            document.querySelectorAll('.tab-pane').forEach(section => {
                section.style.display = 'none';
            });
            
            // نمایش بخش مورد نظر
            const targetPane = document.getElementById(sectionName + '-pane');
            if (targetPane) {
                targetPane.style.display = 'block';
                
                // به‌روزرسانی قیمت‌ها در بخش سیگنال‌ها
                if (sectionName === 'signals') {
                    updateSignalPrices();
                }
            }
        };
        
        // به‌روزرسانی قیمت‌های واقعی در کارت‌های سیگنال
        function updateSignalPrices() {
            try {
                console.log('Updating signal prices');
                
                // دریافت قیمت بیت‌کوین
                const btcPrice = document.getElementById('BTC-USDT-price')?.textContent;
                if (btcPrice && btcPrice !== '--') {
                    const btcSignalPrice = document.getElementById('btc-signal-price');
                    if (btcSignalPrice) {
                        console.log('Updating BTC price to:', btcPrice);
                        btcSignalPrice.textContent = btcPrice;
                    }
                }
                
                // دریافت قیمت اتریوم
                const ethPrice = document.getElementById('ETH-USDT-price')?.textContent;
                if (ethPrice && ethPrice !== '--') {
                    const ethSignalPrice = document.getElementById('eth-signal-price');
                    if (ethSignalPrice) {
                        console.log('Updating ETH price to:', ethPrice);
                        ethSignalPrice.textContent = ethPrice;
                    }
                }
            } catch (error) {
                console.error('Error updating signal prices:', error);
            }
        }
        
        // افزودن دکمه‌های آزمایشی برای مشاهده مستقیم بخش سیگنال‌ها
        const container = document.querySelector('.container');
        const testButtons = document.createElement('div');
        testButtons.className = 'row mt-3 mb-3';
        testButtons.innerHTML = `
            <div class="col-12 d-flex justify-content-center gap-2">
                <button class="btn btn-sm btn-danger" onclick="showSignalsDirectly()">
                    {{ ui_text("show_signals_directly", "نمایش مستقیم سیگنال‌ها") }}
                </button>
                <button class="btn btn-sm btn-warning" onclick="showTechnicalDirectly()">
                    {{ ui_text("show_technical_directly", "نمایش مستقیم تحلیل تکنیکال") }}
                </button>
            </div>
        `;
        container.prepend(testButtons);
        
        // افزودن توابع دسترسی سریع
        window.showSignalsDirectly = function() {
            document.getElementById('signals-pane').style.display = 'block';
            document.getElementById('technical-pane').style.display = 'none';
            document.getElementById('news-pane').style.display = 'none';
            updateSignalPrices();
        };
        
        window.showTechnicalDirectly = function() {
            document.getElementById('signals-pane').style.display = 'none';
            document.getElementById('technical-pane').style.display = 'block';
            document.getElementById('news-pane').style.display = 'none';
        };
        
        // تنظیم وضعیت اولیه بخش‌ها
        document.getElementById('technical-pane').style.display = 'block';
        document.getElementById('signals-pane').style.display = 'none';
        document.getElementById('news-pane').style.display = 'none';
        
        // به‌روزرسانی خودکار قیمت‌ها هر ۳۰ ثانیه
        setInterval(updateSignalPrices, 30000);
        
        // تابع برای ایجاد نمودار قیمت
        function createPriceChart(coinSymbol = 'BTC') {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            // داده‌های نمونه برای نمودار
            const labels = [];
            const prices = [];
            
            // ایجاد داده‌های تصادفی برای ۳۰ روز گذشته
            const today = new Date();
            let basePrice = 0;
            
            // تنظیم قیمت پایه بر اساس ارز
            switch(coinSymbol) {
                case 'BTC': basePrice = 65000; break;
                case 'ETH': basePrice = 3400; break;
                case 'SOL': basePrice = 150; break;
                case 'XRP': basePrice = 0.5; break;
                default: basePrice = 65000;
            }
            
            // ایجاد ۳۰ روز داده
            for (let i = 30; i >= 0; i--) {
                const date = new Date();
                date.setDate(today.getDate() - i);
                labels.push(date.toLocaleDateString('fa-IR'));
                
                // ایجاد قیمت با نوسان تصادفی حول قیمت پایه
                const randomFactor = 0.05; // ۵٪ نوسان
                const change = (Math.random() - 0.5) * randomFactor * basePrice;
                basePrice += change;
                if (basePrice < 0) basePrice = Math.abs(basePrice); // جلوگیری از قیمت منفی
                
                prices.push(basePrice);
            }
            
            // تنظیم رنگ‌ها
            const borderColor = coinSymbol === 'BTC' ? '#F7931A' : 
                               coinSymbol === 'ETH' ? '#627EEA' : 
                               coinSymbol === 'SOL' ? '#00FFB3' : '#0066FF';
                               
            const backgroundColor = coinSymbol === 'BTC' ? 'rgba(247, 147, 26, 0.1)' : 
                                  coinSymbol === 'ETH' ? 'rgba(98, 126, 234, 0.1)' : 
                                  coinSymbol === 'SOL' ? 'rgba(0, 255, 179, 0.1)' : 'rgba(0, 102, 255, 0.1)';
            
            // ایجاد نمودار
            try {
                if (window.priceChart instanceof Chart) {
                    window.priceChart.destroy();
                }
            } catch (error) {
                console.log('خطا در حذف نمودار قبلی:', error);
            }
            
            window.priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `${coinSymbol}/USDT Price`,
                        data: prices,
                        borderColor: borderColor,
                        backgroundColor: backgroundColor,
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            titleFont: {
                                family: 'Vazirmatn'
                            },
                            bodyFont: {
                                family: 'Vazirmatn'
                            },
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += new Intl.NumberFormat('en-US', { 
                                            minimumFractionDigits: 2,
                                            maximumFractionDigits: 2 
                                        }).format(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return new Intl.NumberFormat('en-US', { 
                                        minimumFractionDigits: 0,
                                        maximumFractionDigits: 0
                                    }).format(value);
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            return window.priceChart;
        }
    
        // ایجاد نمودار قیمت اولیه (بیت‌کوین)
        setTimeout(() => {
            createPriceChart('BTC');
        }, 1500);
    
        // تنظیم رویدادهای کلیک روی تب‌های ارزی در تحلیل تکنیکال
        document.querySelectorAll('.btn-group[role="group"] button').forEach(button => {
            button.addEventListener('click', function() {
                // برداشتن وضعیت فعال از همه دکمه‌ها
                document.querySelectorAll('.btn-group[role="group"] button').forEach(btn => {
                    btn.classList.remove('active');
                    btn.classList.remove('btn-secondary');
                    btn.classList.add('btn-outline-secondary');
                });
                
                // فعال کردن دکمه انتخاب شده
                this.classList.remove('btn-outline-secondary');
                this.classList.add('btn-secondary');
                this.classList.add('active');
                
                // تغییر محتوای نمودار و عنوان بر اساس ارز انتخاب شده
                const coinText = this.textContent.trim();
                const titleElement = document.querySelector('#technical-pane .card-header h5');
                
                // به‌روزرسانی نمودار قیمت
                createPriceChart(coinText);
                
                if (titleElement) {
                    let coinName = 'بیت‌کوین';
                    if (coinText === 'ETH') coinName = 'اتریوم';
                    if (coinText === 'SOL') coinName = 'سولانا';
                    if (coinText === 'XRP') coinName = 'ریپل';
                    
                    titleElement.textContent = `تحلیل تکنیکال ${coinName} (تایم‌فریم ساعتی)`;
                }
            });
        });
    });
</script>
{% endblock %}
