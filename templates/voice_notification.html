<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multilingual Voice Notifications | Crypto Barzin</title>
    <link rel="stylesheet" href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css">
    <style>
        body {
            padding-top: 20px;
            padding-bottom: 40px;
        }
        
        .notification-box {
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .language-selector .form-check {
            margin-right: 15px;
            display: inline-block;
        }
        
        .preview-audio {
            margin-top: 20px;
        }
        
        .price-range {
            display: flex;
            align-items: center;
        }
        
        .price-range input {
            flex: 1;
            margin: 0 10px;
        }
        
        #priceValue {
            min-width: 80px;
            text-align: center;
        }
        
        .crypto-icon {
            width: 24px;
            height: 24px;
            margin-left: 5px;
        }
        
        .voice-preview-container {
            background-color: var(--bs-dark);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .btn-voice-preview {
            margin-right: 5px;
        }
        
        .notification-history {
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/">Home</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Multilingual Voice Notifications</li>
                    </ol>
                </nav>
                
                <div class="card bg-dark text-light mb-4">
                    <div class="card-header">
                        <h2 class="mb-0">Multilingual Voice Notification Test</h2>
                    </div>
                    <div class="card-body">
                        <p class="card-text">Create and test voice notifications in different languages for cryptocurrency price changes.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-8">
                <div class="card bg-dark text-light notification-box">
                    <div class="card-body">
                        <h3 class="card-title">Notification Settings</h3>
                        
                        <form id="voiceForm">
                            <div class="mb-3">
                                <label for="cryptoSelect" class="form-label">Cryptocurrency</label>
                                <select class="form-select" id="cryptoSelect">
                                    <option value="BTC">Bitcoin (BTC)</option>
                                    <option value="ETH">Ethereum (ETH)</option>
                                    <option value="SOL">Solana (SOL)</option>
                                    <option value="BNB">Binance Coin (BNB)</option>
                                    <option value="XRP">Ripple (XRP)</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="eventType" class="form-label">Event Type</label>
                                <select class="form-select" id="eventType">
                                    <option value="price_increase">Price Increase</option>
                                    <option value="price_decrease">Price Decrease</option>
                                    <option value="target_reached">Target Price Reached</option>
                                    <option value="stop_loss">Stop Loss Triggered</option>
                                    <option value="high_volatility">High Volatility</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="priceRange" class="form-label">Price Change Percentage (%)</label>
                                <div class="price-range">
                                    <div id="priceValue">5%</div>
                                    <input type="range" class="form-range" id="priceRange" min="1" max="20" value="5">
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Notification Language</label>
                                <div class="language-selector">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="language" id="langFrench" value="fr" checked>
                                        <label class="form-check-label" for="langFrench">
                                            French (Fran√ßais)
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="language" id="langEnglish" value="en">
                                        <label class="form-check-label" for="langEnglish">
                                            English
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="language" id="langArabic" value="ar">
                                        <label class="form-check-label" for="langArabic">
                                            Arabic
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="voiceGender" class="form-label">Voice Gender</label>
                                <select class="form-select" id="voiceGender">
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                </select>
                            </div>
                            
                            <div class="d-flex justify-content-between">
                                <button type="button" id="previewBtn" class="btn btn-primary">Preview Voice</button>
                                <button type="button" id="saveBtn" class="btn btn-success">Save Settings</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card bg-dark text-light">
                    <div class="card-body">
                        <h3 class="card-title">Voice Preview</h3>
                        <div class="voice-preview-container">
                            <div id="previewText" class="mb-3 text-info">
                                <p>Notification text will appear here...</p>
                            </div>
                            <div id="audioPlayer" class="preview-audio">
                                <!-- Audio player will be inserted here -->
                            </div>
                            <div class="mt-3 d-flex justify-content-center">
                                <button id="playBtn" class="btn btn-outline-info btn-voice-preview" disabled>
                                    <i class="bi bi-play-fill"></i> Play
                                </button>
                                <button id="downloadBtn" class="btn btn-outline-success btn-voice-preview" disabled>
                                    <i class="bi bi-download"></i> Download
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card bg-dark text-light mt-4">
                    <div class="card-body">
                        <h3 class="card-title">Notification History</h3>
                        <div class="notification-history" id="notificationHistory">
                            <div class="alert alert-dark text-secondary">
                                No history available
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Price Range Slider
            const priceRange = document.getElementById('priceRange');
            const priceValue = document.getElementById('priceValue');
            
            priceRange.addEventListener('input', function() {
                priceValue.textContent = this.value + '%';
            });
            
            // Preview Button
            const previewBtn = document.getElementById('previewBtn');
            const playBtn = document.getElementById('playBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const previewText = document.getElementById('previewText');
            const audioPlayer = document.getElementById('audioPlayer');
            
            previewBtn.addEventListener('click', function() {
                const crypto = document.getElementById('cryptoSelect').value;
                const eventType = document.getElementById('eventType').value;
                const priceChange = document.getElementById('priceRange').value;
                const language = document.querySelector('input[name="language"]:checked').value;
                const voiceGender = document.getElementById('voiceGender').value;
                
                // Call API to generate voice notification
                fetch('/api/voice-notification/preview', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        crypto: crypto,
                        event_type: eventType,
                        price_change: priceChange,
                        language: language,
                        voice_gender: voiceGender
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Update preview text
                        previewText.innerHTML = `<p><strong>Notification text:</strong></p><p>${data.text}</p>`;
                        
                        // Update audio player
                        audioPlayer.innerHTML = `<audio id="notificationAudio" controls>
                            <source src="${data.audio_url}" type="audio/mpeg">
                            Your browser does not support audio playback.
                        </audio>`;
                        
                        // Enable buttons
                        playBtn.disabled = false;
                        downloadBtn.disabled = false;
                        
                        // Add to history
                        addToHistory(crypto, eventType, language, data.audio_url);
                    } else {
                        previewText.innerHTML = `<p class="text-danger">Error: ${data.error}</p>`;
                    }
                })
                .catch(error => {
                    previewText.innerHTML = `<p class="text-danger">Server connection error: ${error}</p>`;
                });
            });
            
            // Play Button
            playBtn.addEventListener('click', function() {
                const audio = document.getElementById('notificationAudio');
                if (audio) {
                    audio.play();
                }
            });
            
            // Download Button
            downloadBtn.addEventListener('click', function() {
                const audio = document.getElementById('notificationAudio');
                if (audio && audio.src) {
                    const a = document.createElement('a');
                    a.href = audio.src;
                    a.download = 'crypto_notification.mp3';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                }
            });
            
            // Save Button
            const saveBtn = document.getElementById('saveBtn');
            saveBtn.addEventListener('click', function() {
                const crypto = document.getElementById('cryptoSelect').value;
                const eventType = document.getElementById('eventType').value;
                const priceChange = document.getElementById('priceRange').value;
                const language = document.querySelector('input[name="language"]:checked').value;
                const voiceGender = document.getElementById('voiceGender').value;
                
                // Call API to save voice notification settings
                fetch('/api/voice-notification/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        crypto: crypto,
                        event_type: eventType,
                        price_change: priceChange,
                        language: language,
                        voice_gender: voiceGender
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Settings saved successfully.');
                    } else {
                        alert(`Error: ${data.error}`);
                    }
                })
                .catch(error => {
                    alert(`Server connection error: ${error}`);
                });
            });
            
            // Function to add to history
            function addToHistory(crypto, eventType, language, audioUrl) {
                const history = document.getElementById('notificationHistory');
                
                // Clear "no history" message if it exists
                if (history.querySelector('.alert-dark')) {
                    history.innerHTML = '';
                }
                
                // Format event type for display
                let eventTypeText = '';
                switch(eventType) {
                    case 'price_increase': eventTypeText = 'Price Increase'; break;
                    case 'price_decrease': eventTypeText = 'Price Decrease'; break;
                    case 'target_reached': eventTypeText = 'Target Price'; break;
                    case 'stop_loss': eventTypeText = 'Stop Loss'; break;
                    case 'high_volatility': eventTypeText = 'High Volatility'; break;
                }
                
                // Format language for display
                let languageText = '';
                switch(language) {
                    case 'fr': languageText = 'French'; break;
                    case 'en': languageText = 'English'; break;
                    case 'ar': languageText = 'Arabic'; break;
                }
                
                // Create history item
                const historyItem = document.createElement('div');
                historyItem.className = 'alert alert-info p-2 mb-2';
                historyItem.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>${crypto}</strong> - ${eventTypeText} (${languageText})
                        </div>
                        <button class="btn btn-sm btn-outline-light play-history" data-audio="${audioUrl}">
                            <i class="bi bi-play-fill"></i>
                        </button>
                    </div>
                `;
                
                // Add to history (at the beginning)
                history.insertBefore(historyItem, history.firstChild);
                
                // Add event listener to play button
                historyItem.querySelector('.play-history').addEventListener('click', function() {
                    const audioUrl = this.getAttribute('data-audio');
                    
                    // Update audio player
                    audioPlayer.innerHTML = `<audio id="notificationAudio" controls>
                        <source src="${audioUrl}" type="audio/mpeg">
                        Your browser does not support audio playback.
                    </audio>`;
                    
                    // Play audio
                    const audio = document.getElementById('notificationAudio');
                    if (audio) {
                        audio.play();
                    }
                });
            }
        });
    </script>
</body>
</html>