# راهنمای سیستم پیام‌رسانی تلگرام

## مقدمه
سیستم پیام‌رسانی تلگرام «کریپتو برزین» یک راه‌حل یکپارچه برای ارسال گزارش‌های خودکار قیمت و تحلیل‌های فنی ارزهای دیجیتال به کانال تلگرام شماست. این سیستم به‌گونه‌ای طراحی شده که به صورت خودکار در زمان راه‌اندازی برنامه اصلی شروع به کار می‌کند و به طور منظم گزارش‌های مختلف ارسال می‌نماید.

## قابلیت‌های اصلی
1. **ارسال گزارش قیمت هر ۱۰ دقیقه**
   - قیمت‌های لحظه‌ای ارزهای مهم (بیت‌کوین، اتریوم، ریپل، سولانا، بایننس کوین)
   - درصد تغییرات ۲۴ ساعته
   - زمان دقیق گزارش (به وقت تورنتو، کانادا)

2. **ارسال گزارش وضعیت سیستم هر ۶ ساعت**
   - اطلاعات کلی از وضعیت کارکرد سیستم
   - نمایش سرویس‌های فعال

3. **زمان‌بندی هوشمند با قابلیت اطمینان بالا**
   - طراحی شده برای محیط Replit با وجود محدودیت‌های پروسس‌های پس‌زمینه
   - استفاده از ترد داخلی برای جلوگیری از قطع سرویس

## ماژول‌های اصلی
1. **telegram_scheduler_service.py**
   - مدیریت زمان‌بندی و ارسال خودکار پیام‌ها
   - نگهداری وضعیت سیستم و شمارش‌گر گزارش‌ها

2. **replit_telegram_sender.py**
   - ارسال مستقیم پیام به تلگرام از طریق API
   - قالب‌بندی گزارش‌های مختلف
   - دریافت داده‌های قیمت و تحلیل‌ها

## راه‌اندازی و توقف دستی
سیستم پیام‌رسانی به صورت خودکار هنگام راه‌اندازی برنامه اصلی (main.py) شروع به کار می‌کند، اما در صورت نیاز می‌توانید از API‌های موجود برای راه‌اندازی/توقف دستی استفاده کنید:

- **صفحه کنترل تلگرام**: `/telegram_control_panel`
- **راه‌اندازی دستی**: `/api/telegram/start`
- **توقف دستی**: `/api/telegram/stop`
- **ارسال پیام تست**: `/api/telegram/test`

## تنظیمات و پیکربندی
تنظیمات اصلی سیستم پیام‌رسانی در فایل‌های زیر قابل تغییر است:

1. **telegram_scheduler_service.py**:
   - فاصله زمانی گزارش‌های قیمت (پیش‌فرض: ۱۰ دقیقه)
   - فاصله زمانی گزارش‌های سیستم (پیش‌فرض: هر ۶ ساعت)
   - منطقه زمانی نمایش (پیش‌فرض: تورنتو)

2. **replit_telegram_sender.py**:
   - توکن بات تلگرام و چت آیدی 
   - قالب‌بندی گزارش‌ها
   - منابع داده قیمت ارزها

## مدیریت خطاها
سیستم دارای مکانیزم‌های پیشرفته مدیریت خطاست که در صورت بروز مشکل در ارتباط با API یا تلگرام، خطاها را ثبت کرده و تلاش می‌کند عملکرد اصلی خود را حفظ کند.

## نکات مهم
1. **منطقه زمانی**: تمام زمان‌های نمایش داده شده در گزارش‌ها بر اساس منطقه زمانی تورنتو (کانادا) است.
2. **حفظ فعالیت**: سیستم طوری طراحی شده که حتی در محیط Replit با محدودیت‌های اجرای پروسس‌های پس‌زمینه به کار خود ادامه دهد.
3. **بهینه‌سازی مصرف منابع**: سیستم با استفاده از یک ترد داخلی به جای پروسس‌های مستقل، مصرف منابع را بهینه کرده است.

## رفع مشکلات رایج
1. **عدم دریافت پیام**: توکن بات و چت آیدی را بررسی کنید. مطمئن شوید که بات در چت/کانال مورد نظر عضو است.
2. **خطاهای API**: اگر دریافت قیمت‌ها با خطا مواجه شود، سیستم از مقادیر جایگزین استفاده می‌کند.
3. **توقف زمان‌بندی**: اگر به هر دلیلی سرویس زمان‌بندی متوقف شد، از API راه‌اندازی مجدد استفاده کنید.