# راهنمای نظارت سرویس تلگرام Crypto Barzin

این راهنما نحوه استفاده از سیستم نظارت سرویس تلگرام Crypto Barzin را توضیح می‌دهد.

## مقدمه

به دلیل محدودیت‌های محیط Replit در نگهداری فرآیندهای پس‌زمینه، سیستم نظارتی ایجاد کرده‌ایم که به طور خودکار وضعیت سرویس تلگرام را بررسی می‌کند و در صورت توقف سرویس، آن را دوباره راه‌اندازی می‌کند.

## فایل‌های اصلی

1. `telegram_service_watchdog.py` - اسکریپت اصلی نظارت بر سرویس تلگرام
2. `اجرای_نظارت_تلگرام.sh` - اسکریپت راه‌اندازی سیستم نظارت
3. `توقف_نظارت_تلگرام.sh` - اسکریپت توقف سیستم نظارت

## نحوه استفاده

### راه‌اندازی سیستم نظارت

برای راه‌اندازی سیستم نظارت بر سرویس تلگرام، دستور زیر را اجرا کنید:

```bash
./اجرای_نظارت_تلگرام.sh
```

این دستور سیستم نظارت را در پس‌زمینه اجرا می‌کند. سیستم نظارت:
- هر ساعت وضعیت سرویس گزارش‌دهنده هر ۱۰ دقیقه را بررسی می‌کند
- در صورت توقف سرویس، آن را دوباره راه‌اندازی می‌کند
- یک پیام اطلاع‌رسانی به تلگرام ارسال می‌کند

### توقف سیستم نظارت

برای توقف سیستم نظارت، دستور زیر را اجرا کنید:

```bash
./توقف_نظارت_تلگرام.sh
```

### بررسی وضعیت سیستم نظارت

برای بررسی وضعیت سیستم نظارت، دستور زیر را اجرا کنید:

```bash
cat telegram_service_watchdog.log
```

و برای بررسی فایل PID:

```bash
cat telegram_service_watchdog.pid
```

## راه‌اندازی کامل سیستم

برای راه‌اندازی کامل سیستم (هم سرویس گزارش‌دهنده و هم سیستم نظارت)، دستورات زیر را به ترتیب اجرا کنید:

```bash
./اجرای_گزارش_دهنده_هر_۱۰_دقیقه.sh
./اجرای_نظارت_تلگرام.sh
```

## توقف کامل سیستم

برای توقف کامل سیستم، دستورات زیر را به ترتیب اجرا کنید:

```bash
./توقف_نظارت_تلگرام.sh
./توقف_گزارش_دهنده_هر_۱۰_دقیقه.sh
```

## نکات مهم

1. **محیط Replit:** حتی با وجود سیستم نظارت، محیط Replit ممکن است پس از مدتی تمام فرآیندهای پس‌زمینه را متوقف کند. بهترین گزینه میزبانی سیستم روی یک سرور خارجی است.

2. **فاصله زمانی نظارت:** سیستم نظارت هر ساعت وضعیت سرویس را بررسی می‌کند. برای تغییر این فاصله زمانی، مقدار `time.sleep(3600)` را در فایل `telegram_service_watchdog.py` تغییر دهید.

3. **لاگ‌های خطا:** اگر سیستم کار نمی‌کند، لاگ‌های هر دو فایل را بررسی کنید:
   - `telegram_service_watchdog.log`
   - `ten_minute_telegram_sender.log`

## عیب‌یابی

1. **سیستم نظارت راه‌اندازی نمی‌شود:**
   - بررسی کنید که فایل‌های اسکریپت دسترسی اجرا داشته باشند
   - دستور `chmod +x اجرای_نظارت_تلگرام.sh توقف_نظارت_تلگرام.sh` را اجرا کنید
   - لاگ‌های خطا را بررسی کنید

2. **سرویس گزارش‌دهنده راه‌اندازی مجدد نمی‌شود:**
   - بررسی کنید که سیستم نظارت در حال اجرا باشد
   - لاگ‌های نظارت را بررسی کنید
   - فایل PID سرویس گزارش‌دهنده را حذف کنید و دوباره سرویس را راه‌اندازی کنید